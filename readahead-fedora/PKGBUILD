# readahead-fedora
# Maintainer: ying <Jinoto Systems>
# Contributor: ying <Jinoto Systems>

pkgname=readahead-fedora
pkgver=1.5.6
pkgrel=1
pkgdesc="Fedora's implementation of readahead to preload boot process files"
arch=("i686" "x86_64")
url="https://fedorahosted.org/readahead/"
license=('GPL')
depends=('gcc-libs' 'audit' 'util-linux-ng' 'initscripts')
makedepends=('quilt' 'autoconf' 'automake')
install=readahead-fedora.install
source=(http://ftp.de.debian.org/debian/pool/main/r/${pkgname}/${pkgname}_${pkgver}.orig.tar.gz
http://ftp.de.debian.org/debian/pool/main/r/${pkgname}/${pkgname}_${pkgver}-${pkgrel}.diff.gz
readahead.conf
readahead)

build() {
patch -p1 < ${pkgname}_${pkgver}-${pkgrel}.diff

cd "$srcdir/$pkgname-$pkgver"
export QUILT_PATCHES=../debian/patches
quilt push -a

sh autogen.sh
./configure --prefix=/usr --mandir=/usr/share/man

# fix error with make
sed -i "s|^dnl ||" scripts/Makefile

make || return 1
make DESTDIR="$pkgdir/" install

mkdir -p ${pkgdir}/etc/readahead.d
mkdir -p ${pkgdir}/etc/rc.d/functions.d/
rm -rf ${pkgdir}/etc/{cron.daily,cron.monthly,default}
#sed -i 's|/etc/init.d/later-readahead|/.switch-collector-to-later|g' "${pkgdir}/etc/readahead.conf"
#sed -i 's|RAC_MAXTIME="300"|RAC_MAXTIME="100"|g' "${pkgdir}/etc/readahead.conf"
cp -fr ${srcdir}/../readahead.conf ${pkgdir}/etc/readahead.conf
cp -fr ${srcdir}/../readahead ${pkgdir}/etc/rc.d/functions.d/readahead
}



md5sums=('295d7ab128b2c8a1f0df2aeb7b6bccee'
         '8f7b7ab46e6c6e70407ed707bb3d0bff'
         '3d95270937e31d91f7674d204834c1b7'
         '5b9c2a182600fde4b3a40c1ccfbeaba5')
