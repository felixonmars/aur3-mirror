# Maintainer: Michael Schubert <mschu.dev at gmail>

pkgname=pymol-autodock
pkgver=2.1.1
pkgrel=1
pkgdesc="Autodock/Vina plugin for PyMOL"
arch=('any')
url="http://wwwuser.gwdg.de/~dseelig/adplugin"
license=('custom')
depends=('pymol' 'autodocksuite' 'autodock-vina')
source=("http://wwwuser.gwdg.de/~dseelig/autodock.py")
md5sums=('763a44d9ba512dc28809978e81929ca9')

package() {
  cd "$srcdir"

  mkdir -p "$pkgdir/usr/share/licenses"
  head -29 autodock.py > "$pkgdir/usr/share/licenses/autodock"

  sed -i "/autodock_tools_path'] = '/s|''|\
    '/usr/lib/python2.7/site-packages/MGLToolsPckgs/AutoDockTools/Utilities24'|;
    /autogrid_exe'] = '/s|''|'autogrid4'|;
    /autodock_exe'] = '/s|''|'autodock4'|;
    /vina_exe'] = '/s|''|'vina'|" autodock.py

  pydir="/usr/lib/python2.7/site-packages"
  install -Dm644 autodock.py "$pkgdir/$pydir/pmg_tk/startup/autodock.py"
  chmod a+x "$pkgdir/$pydir/pmg_tk/startup"

  cd "$pkgdir/$pydir/pmg_tk/startup"
  python2 -c "import py_compile; py_compile.compile('autodock.py')"
}

