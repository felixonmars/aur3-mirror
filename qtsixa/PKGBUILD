# Thanks to falktx for the QtSixa and Sixad utility.
pkgname=qtsixa
pkgver=1.2.1
pkgrel=5
pkgdesc="An utility to configure and use sixaxis controller via bluetooth."
url="http://sourceforge.net/projects/qtsixa/"
arch=('i686' 'x86_64' 'ppc')
license=('GPL')
backup=('etc/default/sixad')
depends=('bluez' 'python2-qt' 'qt' 'python2' "bluez-hcidump")
makedepends=('patch')
source=(http://downloads.sourceforge.net/qtsixa/QtSixA-"$pkgver"-src.tar.gz
	sixad.patch
	python.patch)
md5sums=('77ed7e9f284d5689f0a58bd3a052b87f'
         'ed806a3a5729a2436a34a11007eac06a'
	 'b8ed89d7f61eff5610d48a32329e6e0e')
build() {
	# patch for sixad daemon
	patch -p0 < $srcdir/sixad.patch
	patch -p1 < $srcdir/python.patch

	cd $srcdir/qtsixa-$pkgver

	make || exit 1

	########## sixad installation, adapted from makefile 'system-install' ##########

        mkdir -p \
		$pkgdir/etc/default/ \
		$pkgdir/etc/rc.d/ \
		$pkgdir/lib/udev/rules.d/ \
		$pkgdir/usr/bin \
		$pkgdir/usr/sbin \
		$pkgdir/usr/share/hal/fdi/policy/20thirdparty/ \
		$pkgdir/usr/share/man/man1/ \
		$pkgdir/usr/share/doc/qtsixa \
		$pkgdir/usr/share/qtsixa \
		$pkgdir/usr/share/applications \
		$pkgdir/usr/share/pixmaps

	cd $srcdir/qtsixa-$pkgver/sixad

        cp init/sixad $pkgdir/etc/rc.d

        #Installing binaries
        cp sixad $pkgdir/usr/bin/

        cp hcid/hcid \
        	bins/hidraw-dump \
        	bins/sixad-bin \
        	bins/sixad-raw \
        	bins/sixad-uinput-sixaxis \
        	bins/sixpair \
        	bins/sixpair-kbd $pkgdir/usr/sbin/

        #Installing misc files
        cp 98-sixad.rules $pkgdir/lib/udev/rules.d/
        cp default/sixad $pkgdir/etc/default/
        cp x11-sony-keypad.fdi $pkgdir/usr/share/hal/fdi/policy/20thirdparty/
        cp mans/* $pkgdir/usr/share/man/man1/

	############ qtsixa installation #############

	cd $srcdir/qtsixa-$pkgver/qtsixa

	cp qtsixa sixa-notify sixa-lq sixa $pkgdir/usr/bin
	cp -r manual/ $pkgdir/usr/share/doc/qtsixa/
	cp qtsixa.desktop $pkgdir/usr/share/applications
	cp qtsixa.xpm $pkgdir/usr/share/pixmaps
	cp -r sixa-notify.desktop \
		icons/ \
		pics/ \
		gui/ \
		lang/ \
		game-profiles/ \
		qtsixa.conf \
		profiles.list.bu \
		sixaxis-profiles/ \
		features.html $pkgdir/usr/share/qtsixa/
	cp $pkgdir/usr/share/qtsixa/profiles.list.bu $pkgdir/usr/share/qtsixa/profiles.list
} 
