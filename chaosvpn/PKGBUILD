pkgname=chaosvpn
pkgver=20111221
pkgrel=1
pkgdesc="Config generator for chaosVPN"
arch=('i686' 'x86_64')
url="http://wiki.hamburg.ccc.de"
license="GPL2"
makedepends=('git' 'flex')
depends=('tinc')
backup=(etc/tinc/chaosvpn.conf etc/conf.d/chaosvpn)

_gitroot='git://github.com/ryd/chaosvpn.git'
_gitname='chaosvpn'

source=(chaosvpn.rc.d)
md5sums=('4cc866d9d295f43fcd89a85e3557927a')

build() {
  mkdir -p $pkgdir/usr/sbin
  mkdir -p $pkgdir/etc/tinc
  mkdir -p $pkgdir/etc/rc.d
  mkdir -p $pkgdir/etc/conf.d

  cd $srcdir

  if [ -e $pkgname ] ; then
    cd $pkgname
    git pull . master
    cd ..
  else
    git clone $_gitroot $_gitname
  fi

  cd $srcdir/$pkgname

  make
  make DESTDIR=$pkgdir install

  install -m 0755 $srcdir/chaosvpn.rc.d $pkgdir/etc/rc.d/chaosvpn
  install -m 0644 $srcdir/${_gitname}/debian/default $pkgdir/etc/conf.d/chaosvpn
  sed -e 's|/sbin/ip|/usr/sbin/ip|g' -i $pkgdir/etc/tinc/chaosvpn.conf
}

#EOF
