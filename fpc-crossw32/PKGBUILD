# $Id: PKGBUILD,v 1.13 2009/03/30 15:50:37 zhayl Exp $
# Maintainer: Daniel Illgen <daniel.illgen@googlemail.com>
# Original PKGBUILD: Sergej Pupykin <sergej@aur.archlinux.org>
# Corrected to 2.4.4: Alexey Khromov <zxalexis@gmail.com>

pkgname=fpc-crossw32
pkgver=2.4.4
pkgrel=2
pkgdesc="fpc/win32 cross compiler and units"
arch=('i686' 'x86_64')
url="http://www.freepascal.org/"
license=('GPL' 'LGPL' 'custom')
depends=('fpc=2.4.4')
source=("ftp://ftp.freepascal.org/pub/fpc/dist/$pkgver/source/fpcbuild-$pkgver.tar.gz"
		"Makefile-mk382.diff")
md5sums=('d069dfd3412bd0d26dcd1b81ac998305'
		'a2242d261b055d08fa4d70e88ca1d1a7')

build() {
  cd ${srcdir}/fpcbuild-$pkgver/fpcsrc/compiler
  patch -uN Makefile.fpc ../../../../Makefile-mk382.diff || return 1
  fpcmake -Tall
  cd ../..
  make NOGDB=1 build OS_TARGET=win32 CPU_TARGET=i386 || return 1
  make NOGDB=1 PREFIX=${pkgdir}/usr crossinstall OS_TARGET=win32 CPU_TARGET=i386 || return 1
  rmdir ${pkgdir}/usr/bin
}

package() {
  mkdir -p $pkgdir/usr/bin
  cd $pkgdir/usr/bin
  ln -s /usr/lib/fpc/$pkgver/ppcross386 .
}
