# Maintainer: Spike29 <leguen.yannick@gmail.com>
# Contributor: SpepS <dreamspepser at yahoo dot it>

_pkg=wiLink
pkgname=wilink
pkgver=2.3.4
pkgrel=2
pkgdesc='A Wifirst application for Instant communications'
arch=('i686' 'x86_64')
url='http://opensource.wifirst.net/projects/wilink/'
license=('GPL3')
groups=
provides=
depends=('qt>=4.7.4' 'libmad' 'libvorbis' 'libxss' 'qxmpp-git' 'qdjango' 'libnotify' 'libgnome-keyring' 'libgphoto2')
optdepends=
makedepends=('cmake>=2.8.2')
conflicts=
replaces=
backup=
install="$pkgname.install"
source=('https://download.wifirst.net/public/wiLink-2.3.4.tar.bz2')
md5sums=('5aa41e23f3885daec95ac65bb5db952a')
 
build() {
	cd "$scrdir"

	# defining appropriate /usr/lib/qt/ path for ArchLinux system
	sed -e 's/qt4/qt/g' -i "$_pkg-$pkgver/CMakeLists.txt"
	sed -e 's/qt4/qt/g' -i "$_pkg-$pkgver/src/qnetio/CMakeLists.txt"

	# building
	cd "$_pkg-$pkgver/"
	mkdir build && cd "build/"
	cmake -DCMAKE_INSTALL_PREFIX=/usr ..
	make
}

package() {
	# installing
	cd "$srcdir/$_pkg-$pkgver/build/"
	make DESTDIR="$pkgdir/" install

 	# higher resolution icon
	rm "$pkgdir/usr/share/pixmaps/$_pkg.xpm"
	install -Dm644 ../src/data/images/128x128/$_pkg.png \
    	"$pkgdir/usr/share/pixmaps/$_pkg.png"
}
