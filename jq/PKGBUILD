# Maintainer: Alex Chamberlain <alex@alexchamberlain.co.uk>
name=jq
pkgname=$name
pkgver=1.1
pkgrel=1
epoch=
pkgdesc="Command-line JSON processor"
arch=('i686' 'x86_64')
url="http://stedolan.github.com/jq/"
license=('custom')
groups=()
depends=()
makedepends=('python2' 'git')
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
#source=('git://github.com/stedolan/jq.git#tag=$name-$pkgver')
source=("$name-$pkgver.patch")
noextract=()
md5sums=('34d165169e23f7d627d79d4d7db0c890')

gitroot=https://github.com/stedolan/jq.git
gitname=$name-$pkgver
#_gittag=$name-$pkgver


build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$gitname" ]]; then
    cd "$gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$gitroot" "$gitname" 
  fi

  cd "$srcdir/$gitname"
  git checkout $gittag

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$gitname-build"
  mkdir "$srcdir/$gitname-build"
  cd "$srcdir/$gitname" && ls -A | grep -v .git | xargs -d '\n' cp -r -t "../$gitname-build" # do not copy over the .git folder
  cd "$srcdir/$gitname-build"

  patch -p1 -i ../../$name-$pkgver.patch
  make prefix=/usr
}

package() {
  cd "$srcdir/$gitname-build"
  make DESTDIR="$pkgdir/" prefix=/usr install
}

# vim:set ts=2 sw=2 et:
