# Maintainer: yescalona <yescalona@ug_uchile_cl>
# Contributor: Juan Miguel Cejuela <jmcejuela@gmail.com>
 

pkgname=modeller
pkgver=9.10
pkgrel=2
pkgdesc="3D Structure Homology Modeller"
arch=('i686' 'x86_64')
url="http://salilab.org/modeller/"
license=('custom')
depends=('python2' 'glib2')
install=modeller.install
source=(http://www.salilab.org/modeller/$pkgver/modeller-$pkgver.tar.gz)
md5sums=('4d588bbe3b323ee31ace030fa1bb216f')
build(){
    cd $srcdir/$pkgname-$pkgver 
    
    #set default values:
    VER="9.10"
    VERENV="9v10"
    MOD="MODELLER ${VER}"
    PROGRAM=mod${VER}
    MODINSTALL="$pkgdir/usr/lib/modeller"
    _MODINSTALL="/usr/lib/modeller"
    
    if [ "$CARCH" = "i686" ]; then
        # for i686
        EXECUTABLE_TYPE="i386-intel8"
    else # for x86_64
        EXECUTABLE_TYPE="x86_64-intel8"
    fi
    
    find . -type d -exec chmod 755 {} \;
    
    #Installing Modeller files
    mkdir -p "${MODINSTALL}"
    cp -R README INSTALLATION doc examples modlib src "${MODINSTALL}"
    mkdir -p "${MODINSTALL}/bin"
    cp -R bin/*.top bin/modslave.py bin/lib bin/${PROGRAM}_${EXECUTABLE_TYPE} \
        "${MODINSTALL}/bin"
    mkdir -p "${MODINSTALL}/lib"
    cp -R lib/${EXECUTABLE_TYPE} "${MODINSTALL}/lib"


    #Creating Modeller startup scripts
    sed -e "s;EXECUTABLE_TYPE${VERENV}=xxx;EXECUTABLE_TYPE${VERENV}=$EXECUTABLE_TYPE;" \
        -e "s;MODINSTALL${VERENV}=xxx;MODINSTALL${VERENV}=\"$_MODINSTALL\";" \
        bin/modscript > "${MODINSTALL}/bin/${PROGRAM}"
    sed -e "s;@TOPDIR\@;\"$_MODINSTALL\";" \
        -e "s;@EXETYPE\@;$EXECUTABLE_TYPE;" \
        bin/modpy.sh.in > "${MODINSTALL}/bin/modpy.sh"
    chmod a+x "${MODINSTALL}/bin/${PROGRAM}" "${MODINSTALL}/bin/modpy.sh"
    sed -e "s;/usr/bin/python;/usr/bin/python2;" \
        bin/modslave.py > "${MODINSTALL}/bin/modslave.py"
    
    #Creating simbol link
    install -d $pkgdir/usr/bin/
    ln -sf ${_MODINSTALL}/bin/mod$pkgver  $pkgdir/usr/bin/mod$pkgver

    #install -d $pkgdir/usr/lib/python2.7/site-packages
    #ln -sf ${_MODINSTALL}/modlib/modeller  $pkgdir/usr/lib/python2.7/site-packages/modeller
    #ln -sf ${_MODINSTALL}/lib/x86_64-intel8/python2.5/_modeller.so $pkgdir/usr/lib/python2.7/site-packages/_modeller.so
} 

