# Maintainer: Marti Raudsepp <marti@juffo.org>

pkgname=libdwarf
pkgver=20110113
pkgrel=1
pkgdesc="Static library for handling DWARF Debugging Information Format"
arch=(i686 x86_64)
license=('GPL' 'LGPL')
url="http://reality.sgiweb.org/davea/dwarf.html"
makedepends=('libelf')
source=(http://reality.sgiweb.org/davea/$pkgname-$pkgver.tar.gz)

build() {
  cd $srcdir/dwarf-$pkgver/libdwarf

  ./configure || return 1
  make || return 1

  install -d $pkgdir/usr/lib
  install libdwarf.a $pkgdir/usr/lib

  install -d $pkgdir/usr/include/libdwarf
  install dwarf.h libdwarf.h $pkgdir/usr/include/libdwarf

  install -dm 755 $pkgdir/usr/share/doc/$pkgname
  install README NEWS *.pdf $pkgdir/usr/share/doc/$pkgname

  cd $srcdir/dwarf-$pkgver/dwarfdump2

  ./configure --prefix=/usr CFLAGS=-I../libdwarf CXXFLAGS=-I../libdwarf LDFLAGS=-L../libdwarf || return 1
  # disable parallelization; -j5 build fails ~20% of the time on my machine
  make -j1 || return 1

  install -Dm755 dwarfdump $pkgdir/usr/bin/dwarfdump || return 1
  install -Dm644 dwarfdump.1 $pkgdir/usr/share/man/man1/dwarfdump.1 || return 1
  install -Dm644 dwarfdump.conf $pkgdir/usr/lib/dwarfdump.conf || return 1
}
md5sums=('c7d458a0c016976ee72ba8b95dfe9004')
