#Contributor: Yahya Mohajer < yaya_2013 At yahoo Dot com >

pkgname=jenkins
pkgver=1.440
pkgrel=1
_wrapver=3.4.1
pkgdesc="Extensible Continuous Integration Server. Hudson forks"
url="http://jenkins-ci.org/"
arch=('i686' 'x86_64')
license=('MIT')
depends=('java-environment')
optdepends=('apache: a full featured webserver'
            'maven: a java project management and project comprehension tool'
            'ttf-dejavu: Font family based on the Bitstream Vera Fonts with a wider range of characters'
            'libcups: The CUPS Printing System - client libraries and headers')

conflicts=('jenkins')
provides=('jenkins')
options=(!strip !docs )

install=jenkins.install
backup=(opt/jenkins/conf/wrapper.conf)
source=(http://updates.jenkins-ci.org/download/war/${pkgver}/jenkins.war
        http://wrapper.tanukisoftware.org/download/$_wrapver/wrapper-delta-pack-$_wrapver.tar.gz
        'wrapper.conf'
        'jenkins')	

noextract=(jenkins.war)

md5sums=('f07751db1dd006c979115d7a3ddce7a9'
         'a4eb5f779b09fdba71c8b94450169bcc'
         'f81c36c4b4af84ca647775e0f3e21729'
         '4b230f5dbccb863f72bbc7a19b9c0e9c')

build() {
  cd ${srcdir}

  # Create directory
  install -dm755 $pkgdir/opt/jenkins
  install -dm755 $pkgdir/opt/jenkins/bin
  install -dm755 $pkgdir/opt/jenkins/lib
  install -dm755 $pkgdir/opt/jenkins/conf
  install -dm755 $pkgdir/opt/jenkins/logs
  install -dm755 $pkgdir/opt/jenkins/tmp

  # prepare wrapper
  if [ $CARCH = 'x86_64' ]; then
    install -Dm755  $srcdir/wrapper-delta-pack-$_wrapver/bin/wrapper-linux-x86-64    $pkgdir/opt/jenkins/bin/wrapper
    install -Dm644 $srcdir/wrapper-delta-pack-$_wrapver/lib/libwrapper-linux-x86-64.so $pkgdir/opt/jenkins/lib/
  elif [ $CARCH = 'i686' ]; then
    install -Dm755  $srcdir/wrapper-delta-pack-$_wrapver/bin/wrapper-linux-x86-32 $pkgdir/opt/jenkins/bin/wrapper
    install -Dm644  $srcdir/wrapper-delta-pack-$_wrapver/lib/libwrapper-linux-x86-32.so $pkgdir/opt/jenkins/lib/
  fi
   install -Dm644 $srcdir/wrapper-delta-pack-$_wrapver/lib/wrapper.jar $pkgdir/opt/jenkins/lib/
   install -Dm644 $srcdir/wrapper-delta-pack-$_wrapver/logs/wrapper.log $pkgdir/opt/jenkins/logs/

   install -Dm644 $srcdir/jenkins.war $pkgdir/opt/jenkins/lib/

   install -Dm644 $srcdir/wrapper.conf $pkgdir/opt/jenkins/conf/
   install -Dm755 $srcdir/jenkins $pkgdir/opt/jenkins/bin/

   mkdir -p $pkgdir/var/lib/jenkins
   mkdir -p $pkgdir/var/run/jenkins

}
