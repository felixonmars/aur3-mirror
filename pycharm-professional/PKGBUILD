# Maintainer: (epsilom) Xavier Corredor <xavier.corredor.llano (a) gmail.com>

pkgname=pycharm-professional
pkgver=3.1.2
pkgrel=1
pkgdesc="Powerful Python and Django IDE. Professional version."
arch=('any')
options=('!strip')
url="http://www.jetbrains.com/pycharm/"
conflicts=('pycharm' 'pycharm-community')
provides=('pycharm')
license=('Commercial')
depends=('java-runtime>=6' 'giflib>=5.0.5-1')
source=(http://download.jetbrains.com/python/$pkgname-$pkgver.tar.gz 'pycharm-professional.desktop')
sha256sums=('8be5cbddc241f475415b54631add7fa8b64feefa48673aa84b641cf0bc3a384f'
            '3e2597fbc404ee6814d3defb7dc3732b6af1dc765b27fb57e71023326ba0fa9f')

package() {
  # base
  cd $srcdir
  mkdir -p $pkgdir/opt/$pkgname
  cp -R $srcdir/pycharm-$pkgver/* $pkgdir/opt/$pkgname
  mkdir -p $pkgdir/usr/share/{applications,pixmaps}
  mkdir -p $pkgdir/usr/bin/
  install -Dm644 $pkgdir/opt/$pkgname/bin/pycharm.png $pkgdir/usr/share/pixmaps/pycharm.png
  # lisense
  mkdir -p $pkgdir/usr/share/licenses/$pkgname/
  install -Dm644 $srcdir/pycharm-$pkgver/license/PyCharm_license.txt $pkgdir/usr/share/licenses/$pkgname/PyCharm_license.txt
  # exec
  ln -s /opt/pycharm-professional/bin/pycharm.sh $pkgdir/usr/bin/pycharm
  # app file desktop
  install -Dm644 $startdir/pycharm-professional.desktop $pkgdir/usr/share/applications/
  
  # delete some conflicts files for i686 
  if [[ $CARCH = 'i686' ]]; then
          rm -f $pkgdir/opt/$pkgname/bin/libyjpagent-linux64.so
          rm -f $pkgdir/opt/$pkgname/bin/fsnotifier64
  fi

  # enable anti-aliasing text in pycharm options
  if [[ $CARCH = 'i686' ]]; then
	echo '-Dawt.useSystemAAFontSettings=on' >> $pkgdir/opt/$pkgname/bin/pycharm.vmoptions
        echo '-Dswing.aatext=true' >> $pkgdir/opt/$pkgname/bin/pycharm.vmoptions
     else
	echo '-Dawt.useSystemAAFontSettings=on' >> $pkgdir/opt/$pkgname/bin/pycharm64.vmoptions
        echo '-Dswing.aatext=true' >> $pkgdir/opt/$pkgname/bin/pycharm64.vmoptions
  fi
  
}

# vim:set ts=2 sw=2 et: