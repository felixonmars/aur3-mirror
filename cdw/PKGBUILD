# Maintainer: kfgz <kfgz at interia pl>
# Contributor: Joey Mazzarelli <mazzarelli at gmail dot com>

pkgname=cdw
pkgver=0.6.0
pkgrel=2
pkgdesc="Ncurses CD writer program which uses cdrecord and mkisofs"
arch=('i686' 'x86_64')
url="http://cdw.sourceforge.net/"
license=('GPL')
depends=(cdrkit ncurses libcdio)
#depends=(cdrkit lame vorbis-tools ncurses libmysqlclient perl-xml-parser libcdio)
#options=('!makeflags')
#options=('!strip')
source=(${pkgname}-${pkgver}.tar.gz::http://sourceforge.net/projects/${pkgname}/files/${pkgname}/${pkgname}%20${pkgver}/${pkgname}-${pkgver}.tar.gz/download)
md5sums=('808601f91e3aa13e539b98e684cec1a9')

build() {
  cd ${srcdir}/${pkgname}-${pkgver}/src
  
  #some dirty patching ;)
  for file in *c *h
  do
   sed -i "s/ncursesw\/ncurses.h/ncurses.h/g" ${file}
   sed -i "s/ncursesw\/form.h/form.h/g" ${file}
   sed -i "s/ncursesw\/menu.h/menu.h/g" ${file}
   sed -i "s/ncursesw\/panel.h/panel.h/g" ${file}
  done
  
  for dir in `LC_ALL=C ls -l | grep ^d | awk '{print $9}'`
  do
   cd ${srcdir}/${pkgname}-${pkgver}/src/${dir}
      for file in *c *h
      do
       sed -i "s/ncursesw\/ncurses.h/ncurses.h/g" ${file}
       sed -i "s/ncursesw\/form.h/form.h/g" ${file}
       sed -i "s/ncursesw\/menu.h/menu.h/g" ${file}
       sed -i "s/ncursesw\/panel.h/panel.h/g" ${file}
      done
  done
  
  cd ${srcdir}/${pkgname}-${pkgver}
  
  #./configure --prefix=/usr --enable-debug
  ./configure --prefix=/usr
  make
}

package() {
  cd ${srcdir}/${pkgname}-${pkgver}
  make prefix=${pkgdir}/usr install
}
