# Maintainer: Jochen Schalanda <jochen+aur (at) schalanda.name>
# Contributor: Thomas Dziedzic <gostrc (at) gmail>
# Contributor: Chris Giles <Chris.G.27 (at) Gmail.com>
# Contributor: seblu <seblu+arch (at) seblu.net>
# Contributor: squiddo <squiddo (at) intheocean.net>
pkgname=dpkg
pkgver=1.16.1.1
pkgrel=1
pkgdesc="The Debian Package Manager.  Don't use it instead of Arch's 'pacman'."
arch=('i686' 'x86_64')
url='http://packages.debian.org/${pkgname}'
license=('GPL')
depends=('bzip2' 'perl-timedate')
makedepends=('gcc' 'make' 'patch')
optdepends=('fakeroot')
replaces=(dpkg-ubuntu)
conflits=(dpkg-ubuntu)
#options=(!emptydirs)
source=(http://ftp.debian.org/debian/pool/main/d/${pkgname}/${pkgname}_${pkgver}.tar.bz2 dpkg-rsyncable.patch dpkg-arch.patch)
md5sums=('73fb4d67dbc9f9f14a776187429ce3f1'
         '9bf2d0d6dd5b9d6f573123b9f94c0fc5'
         '86d25c0ee45df6e4821f16a1c9f4b60c')

build() {
	cd ${pkgname}-${pkgver}

	# Config
	sed -i 's|<ncursesw/curses.h>|<curses.h>|g' dselect/{dselect.h,Makefile.in} || return 1
	sed -i 's|<ncursesw/term.h>|<term.h>|g' dselect/main.cc || return 1

	patch -p0 -i "${startdir}/dpkg-rsyncable.patch"
	patch -p0 -i "${startdir}/dpkg-arch.patch"

	# Build
	./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --without-start-stop-daemon || return 1
	make || return 1
	make DESTDIR=${pkgdir} install || return 1

	# Variables
	install -d ${pkgdir}/var/${pkgname}/updates/
	touch ${pkgdir}/var/lib/${pkgname}/{status,available}
}
