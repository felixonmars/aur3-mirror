# Maintainer: Simo Huhtiranta <simo_huhtirantaATpp_inet_fi>  
# Contributor: Tilmann Becker <tilmann.becker@web.de> 

pkgname=scribus-svn
pkgver=17429
pkgrel=1
pkgdesc="A desktop publishing program - Version from SVN"
arch=(i686 x86_64)
url="http://www.scribus.net"
license=('GPL')
install=${pkgname}.install
depends=('libcups>=1.2.10'       \
         'lcms>=1.17'            \
         'qt>=4.3.0'             \
         'ghostscript>=8.60'     \
         'libart-lgpl>=2.3.19'   \
         'python2>=2.5'          \
       	 'libxml2>=2.6.27'       \
         'cairo'                 \
         'desktop-file-utils'    \
         'freetype2>=2.3.0'      \
         'libtiff>=3.6.0'        \
         'libjpeg'               \
         'pixman>=0.15.16'       \
         'qtwebkit>=2.2'         \
         )

makedepends=('subversion' 'cmake' 'gcc>=4.0' 'make')
# options=(!libtool force !makeflags)
provides=('scribus')
conflicts=('scribus')
source=(${pkgname}.desktop)
md5sums=('aec1cd630e78fe47df07b0ce4a725f7d')

_svntrunk='svn://scribus.net/trunk'
_svnmod='Scribus'

build() {
  cd $srcdir

  if [ -d $_svnmod/.svn ]; then
	  (cd $_svnmod && svn up -r $pkgver)
  else
	  svn co $_svntrunk --config-dir ./ $_svnmod -r $pkgver
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."
  
  rm -rf $srcdir/$_svnmod-build
  mkdir $_svnmod-build
  cd $_svnmod-build

# cmake ../$_svnmod/Scribus -DCMAKE_INSTALL_PREFIX:PATH=/opt/scribus/ -DWANT_SYSTEM_CAIRO=1
# cmake ../$_svnmod/Scribus -DCMAKE_INSTALL_PREFIX:PATH=/opt/scribus/ -DWANT_PRIVATE_CAIRO=1
  cmake ../$_svnmod/Scribus -DCMAKE_INSTALL_PREFIX:PATH=/usr/         -DWANT_PRIVATE_CAIRO=1
  
  sed -i 's|-Wl,--as-needed||' $srcdir/$_svnmod-build/scribus/CMakeFiles/scribus.dir/link.txt
   
  make
  make DESTDIR=$pkgdir install

  install -Dm644 $startdir/scribus-svn.desktop  $pkgdir/usr/share/applications/scribus-svn.desktop
}


