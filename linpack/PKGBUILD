# Contributor: graysky <graysky AT archlinux dot us>
pkgname=linpack
true && pkgname=(linpack linpack-docs)
pkgver=10.3.7.011
pkgvershort=10.3.7
pkgrel=1
arch=('i686' 'x86_64')
license=('custom')
url="http://software.intel.com/en-us/articles/intel-math-kernel-library-linpack-download"
options=(!strip)
install=$pkgname.install
source=(http://registrationcenter-download.intel.com/akdlm/irc_nas/2392/l_lpk_p_$pkgver.tgz linpack.conf runme.template)

build() {
if [ "$CARCH" = "x86_64" ]; then 
	bit=64
else
	bit=32
fi

# sanity check
[[ -z $bit ]] && echo "Cannot determine architecture of this system!" && exit 
export bit
}

package_linpack() {
cd "$srcdir"
eval "sed -e 's/TT/$bit/g' <runme.template >linpack_runme_xeon$bit"
install -D -m755 linpack_runme_xeon$bit "$pkgdir"/usr/bin/linpack_runme_xeon$bit
install -D -m644 linpack.conf "$pkgdir"/etc/linpack.conf
#install -D -m644 lininput.template "$pkgdir"/etc/lininput_xeon$bit
install -D -m644 "$srcdir"/linpack_$pkgvershort/doc/lpkEULA.txt "$pkgdir"/usr/share/licenses/linpack/lpkEULA.txt

cd "$srcdir"/linpack_$pkgvershort/benchmarks/linpack
install -D -m644 xhelp.lpk "$pkgdir"/usr/share/doc/${pkgname}/xhelp.lpk
install -D -m755 xlinpack_xeon$bit "$pkgdir"/usr/bin/xlinpack_xeon$bit
}

package_linpack-docs() {
cd "$srcdir"/linpack_$pkgvershort/doc
install -D -m644 lpksupport.txt "$pkgdir"/usr/share/docs/linpack/lpksupport.txt
cp -r mkl_userguide "$pkgdir"/usr/share/docs/linpack
}
pkgdesc='Benchmark and stability test based on linear algebra. Excellent app for stress testing overclocked systems. Intel CPUs only!'
sha256sums=('7690fa51ea505757faea4b935bc49ae3c75b350d0545ba041967d3373703764d'
            '02d1eeab6e55210dca32be5fb5bfaf20f3962145702fc3e1da013b33440fb9e4'
            'defdf56eac12cd607b3d153584fe935d344a5e4b31a7492d25ac154da513e0c5')
