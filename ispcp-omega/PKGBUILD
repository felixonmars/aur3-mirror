# Maintainer: Techlive Zheng<techlivezheng [at] gmail [dot] com>
pkgname=ispcp-omega
pkgdesc="A project founded to build a Multi Server Control and Administration Panel without limits."
pkgver=1.0.7
pkgrel=1
arch=('i686' 'x86_64')
url="http://isp-control.net/"
license=('MPL' 'LGPL' 'GPLv2')
groups=()
depends=(
        'xz'
        'lynx'
        'ispell'
        'net-snmp'
        'net-tools'
        'bind>=9'
        'apache'
        'openssh'
        'awstats'
        'postfix'
        'proftpd'
        'postgrey'
        'procmail'
        'dnsutils'
        'rkhunter'
        'iptables'
        'cyrus-sasl'
        'chkrootkit'
#       'policy-weight'
        'courier-imap'
        'courier-authlib'
        'libsasl>=2'
        'libmcrypt'
        'libmysqlclient'
        'php'
        'php-gd'
        'php-cgi'
        'php-pear'
        'php-mcrypt'
        'mod_fcgid'
        'mod_fastcgi'
        'mysql'
        'mysql-clients'
        'perl'
        'perl-berkeleydb'
        'perl-crypt-cbc'
        'perl-crypt-blowfish'
        'perl-crypt-passwdmd5'
        'perl-date-calc'
        'perl-date-manip'
        'perl-datetime'
        'perl-datetime-timezone'
        'perl-dbd-mysql'
        'perl-dbi'
        'perl-digest-md5'
        'perl-file-copy-recursive'
        'perl-file-mimeinfo'
        'perl-html-parser'
        'perl-io-stringy'
        'perl-mail-sendmail'
        'perl-mailtools'
        'perl-mime-tools'
        'perl-net-dns'
        'perl-net-libidn'
        'perl-net-netmask'
        'perl-net-smtp-server'
        'perl-term-readkey'
        'perl-term-read-password'
        'perl-timedate'
        )
optdepends=()
makedepends=()
provides=()
replaces=()
conflicts=()
backup=('etc/ispcp/ispcp.conf' 'srv/http/ispcp/engine/ispcp-db-keys.pl' 'srv/http/ispcp/engine/messenger/ispcp-db-keys.pl' 'srv/http/ispcp/gui/include/ispcp-db-keys.php')
options=()
install=${pkgname}.install
source=("ispcp-omega-${pkgver}.tar.bz2::http://sourceforge.net/project/downloading.php?group_id=189485&filename=ispcp-omega-${pkgver}.tar.bz2" "config.arch.tar.gz" "Makefile.arch")
noextract=("config.arch.tar.gz")
changelog=Changelog

build() {
  cd "$srcdir/$pkgname-$pkgver"

  cp ../Makefile.arch . || return 1

  if [ -d configs/arch ];then
    rm -rf configs/arch
  fi

  tar zxf ../config.arch.tar.gz -C configs/ || return 1

  mkdir -p configs/common/pma/parts

  sed -i "s:error.png:error:g" gui/reseller/users.php gui/include/admin-functions.php
  sed -i "s:reload.png:reload:g" gui/reseller/users.php gui/include/admin-functions.php

  find . -name Makefile -print | xargs sed -i "s:/usr/bin/install:/bin/install:g" || return 1
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  make -f Makefile.arch INST_PREF="$pkgdir" install || return 1

  find "$pkgdir" -type f -name empty-file -delete || return 1
}

md5sums=('dfebf84b49d59ef46c3b5710811ec772'
         '1c9dfa95f8ffe4db8f9361cd47364cbf'
         'd1ab43d000113e223d6c04ccd8f1e856')
