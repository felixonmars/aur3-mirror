# Maintainer: Moritz Fischer <moritz.fischer@student.kit.edu>
pkgname=gnuradio-git
pkgver=20120411
pkgrel=1
pkgdesc="free software development toolkit that provides the signal processing runtime and processing blocks to implement software radios using readily-available, low-cost external RF hardware and commodity processors"
arch=('i686' 'x86_64')
license=('GPL')
depends=('fftw' 'python-numpy' 'boost' 'cppunit' 'swig' 'gsl' 'blas' 'guile' 'ettus-uhd-git')
makedepends=('git')
optdepends=('wxpython: gr-wxgui' 'python-cheetah: grc' 'python2-lxml: grc' 'qwtplot3d: gr-qtgui' 'sdcc: firmware and all the parts needing USRP' 'doxygen: docs autogenerated documentation' 'pyxml: grc' 'pygtk: grc' 'pkgconfig' 'pyqwt: gr-qtgui')
provides=('gnuradio')
url="http://gnuradio.org"
source=()
md5sums=()
conflicts=(gnuradio)

_gitroot=git://gnuradio.org/gnuradio
_gitname=gnuradio

build() {
	export PYTHON=python2
	cd ${srcdir}
	if [ -d $_gitname ]; then
		cd $_gitname && git reset HEAD --hard && git clean -x -d -f && git pull origin
		msg "Updated the local files."
	else
		git clone $_gitroot
		msg "GIT checkout done or server timeout"
		cd $_gitname
	fi
	msg "Starting build."
	mkdir build && cd build && cmake -DPYTHON_EXECUTABLE=$(which python2) -DCMAKE_INSTALL_PREFIX=/usr ../
	make || return 1
}

check()
{
	cd ${srcdir}/$_gitname/build
	export PYTHON=python2
	make test || return 1
}

package()
{
	msg "Replacing filenames to use python2."
	sed -i -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" $(find $srcdir -name '*.py') $(find $srcdir -name 'gnuradio-companion' -o -name 'flow_graph.tmpl')
	cd ${srcdir}/$_gitname/build
	make DESTDIR=${pkgdir} install || return 1
}
