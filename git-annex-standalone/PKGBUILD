# Maintainer: Sairon Istyar <saironiq@gmail.com>

## binaries to remove from resulting standalone package
## ('cuz they're so fsckin' ol' and i don't give a shiath about compatibility!!!1)
_rmbin=(cp curl git gpg lsof rsync sh sha1sum sha224sum \
        sha256sum sha384sum sha512sum ssh wget xargs)

pkgname=git-annex-standalone
pkgver=4.20130314
pkgrel=1
pkgdesc='Standalone precompiled version of git-annex bundled with libs and utils, batteries included. Choking Hazard: This product has small parts; keep away from children under 3 years old.'
arch=('i686' 'x86_64')
url="http://git-annex.branchable.com/"
license=(GPL3)
provides=(git-annex)
conflicts=(git-annex git-annex-bin)

# all of these can be left out if not deleting $_rmbin binaries
depends=(coreutils curl git gnupg lsof rsync bash openssh wget findutils)

_file=git-annex-standalone-i386-$pkgver.tar.gz
source=($_file::http://downloads.kitenet.net/git-annex/linux/current/git-annex-standalone-i386.tar.gz \
	git-annex \
  git-annex-webapp
  runshell.patch)
md5sums=('b16bc43b32ab557ec02a543097c052d9' \
  'a3585297cb77ab2cf032c9b59388b3e8' \
  'd079de3f7324b974cd77764aa6a17085' \
  'f67548693207e48892631e912de5c9e8')

package() {
  mkdir -p $pkgdir/opt $pkgdir/usr/bin

  cp -R $srcdir/git-annex.linux $pkgdir/opt/

  patch $pkgdir/opt/git-annex.linux/runshell runshell.patch

  for file in ${_rmbin[@]} ; do
    msg "  Removing $file executable from package..."
    rm $pkgdir/opt/git-annex.linux/bin/$file
  done

  cp $srcdir/git-annex $pkgdir/usr/bin/
  chmod +x $pkgdir/usr/bin/git-annex

  cp $srcdir/git-annex-webapp $pkgdir/usr/bin/
  chmod +x $pkgdir/usr/bin/git-annex-webapp

  ln -s git-annex $pkgdir/usr/bin/git-annex-shell
}
