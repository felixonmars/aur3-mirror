#Originally by AqD
#Last edited by - Victor Aurélio <victoraur.santos@gmail.com>
# Maintainer: Victor Aurélio <victoraur.santos@gmail.com>
# Contributor: Jristz <prflr88@gmail.com>

pkgname=gtk2-aqd
pkgver=2.24.19
pkgrel=1
pkgdesc="The GTK+ Toolkit (v2), with mac-style menubar"
arch=(i686 x86_64)
url="http://www.gtk.org/"
install=gtk2.install
depends=('atk' 'pango' 'libxcursor' 'libxinerama' 'libxrandr' 'libxi' 'libxcomposite' 'libxdamage'
         'shared-mime-info' 'cairo' 'libcups' 'gtk-update-icon-cache')
makedepends=('atk' 'pango' 'libxcursor' 'libxinerama' 'libxrandr' 'libxi' 'libxcomposite' 'libxdamage'
             'shared-mime-info' 'cairo' 'libcups' 'gdk-pixbuf2' 'gobject-introspection')
provides=("gtk2=$pkgver")
replaces=('gtk2' 'gtk2-docs')
conflicts=('gtk2')
options=('!libtool')
backup=(etc/gtk-2.0/gtkrc)
license=(LGPL)
source=("http://ftp.gnome.org/pub/GNOME/sources/gtk+/2.24/gtk+-$pkgver.tar.xz"
        xid-collision-debug.patch
        gtk-gtkmenubar.patch)
backup=(etc/gtk-2.0/gtkrc)
sha256sums=('15b8bf463eba99abfa58270662914e8e9b83568ab4945b5f0ef1aa29e90becb8'
            'b9ed556b30184e81d53c9c6eadd150a323c6aea53031c70f5052f947b36bf976'
            '0403ed66e82babc1c8f2ce9b7f201fa263e91784d32e12e942af96e2885ec603')

build() {
    cd gtk+-$pkgver

    ## Apply Patches
    patch -Np0 < ${startdir}/xid-collision-debug.patch
    patch -Np0 < ${startdir}/gtk-gtkmenubar.patch


    CXX=/bin/false ./configure --prefix=/usr \
                                --sysconfdir=/etc \
                                --localstatedir=/var \
                                --with-xinput=yes

    sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool                                
    make
}

package() {
    cd gtk+-$pkgver

    make DESTDIR="$pkgdir" install
    sed -i "s#env python#env python2#" $pkgdir/usr/bin/gtk-builder-convert
    echo 'gtk-fallback-icon-theme = "gnome"' > "$pkgdir/etc/gtk-2.0/gtkrc"

    #split this out to use with gtk3 too
    rm $pkgdir/usr/bin/gtk-update-icon-cache
}
