#Contributor: Eric Forgeot < http://ifiction.free.fr > & franzrogar
pkgname=renpy-bin
pkgrealname=renpy
pkgver=6.15
pkgrel=1
pkgdesc="A free and cross-platform engine that helps you use words, pictures, and sounds to tell stories with the computer."
arch=(i686 x86_64)
url="http://www.renpy.org"
license=(MIT)
#depends=(python-pygame java-runtime)
depends=(gtk2 zenity)
if test "$CARCH" == x86_64; then
  depends=("${depends[@]}" lib32-alsa-lib lib32-zlib lib32-libxmu)
fi
conflicts=(renpy)

source=(http://www.renpy.org/dl/6.15.1/renpy-6.15.1-sdk.tar.bz2)

md5sums=(5f2a3b7f9a76f3e3b4af718c50df6318)


build() {

	#Some problems about renpy on linux are discussed there:
	#http://lemmasoft.renai.us/forums/viewtopic.php?f=8&t=4770
	
  cd $srcdir/${pkgrealname}-${pkgver}-sdk
	#rm -rf $srcdir/${pkgrealname}-${pkgver}/jedit
	
	mkdir -p $pkgdir/usr/share/renpy
	mkdir -p $pkgdir/usr/bin
	
	cp -fr $srcdir/${pkgrealname}-${pkgver}-sdk/* $pkgdir/usr/share/renpy
	#chmod -R 777 $pkgdir/usr/share/renpy
	
	#starting script
	echo "if [ -d ~/renpy_projects ]; then
echo "The renpy projects is already existing, using it."
else
mkdir ~/renpy_projects
fi
cd ~/renpy_projects
/usr/share/renpy/renpy.sh
" > $pkgdir/usr/bin/renpy

	chmod +x $pkgdir/usr/bin/renpy
	
	#desktop icons
	mkdir -p $pkgdir/usr/share/pixmaps
	cp $srcdir/../renpy_logo.png $pkgdir/usr/share/pixmaps/renpy.png
	
	install -D -m644 $srcdir/../renpy.desktop $pkgdir/usr/share/applications/renpy.desktop
	
if test "$CARCH" != x86_64; then
  rm -fr $pkgdir/usr/share/renpy/lib/linux-x86_64/*.so*
  rm -fr $pkgdir/usr/share/renpy/lib/linux-x86_64/python
  rm -fr $pkgdir/usr/share/renpy/lib/linux-x86_64/*
fi
	

	#getting scite again, as discussed on http://lemmasoft.renai.us/forums/viewtopic.php?f=8&t=4133&hilit=config.editor
	
	rm $srcdir/scite/scite.exe
	cp -fr $srcdir/scite $pkgdir/usr/share/renpy/
	#mv $pkgdir/usr/share/renpy/launcher/editor.rpy $pkgdir/usr/share/renpy/launcher/editor.rpy.jedit
	#cp -fr $srcdir/${pkgrealname}-${pkgver}/launcher/editor.rpy $pkgdir/usr/share/renpy/launcher/

}
