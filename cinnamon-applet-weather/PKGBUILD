# Maintainer: ktalog <thektalog@gmail.com>

pkgname=cinnamon-applet-weather
pkgver=1.5.1
pkgrel=1
pkgdesc="Cinnamon applet"
arch=('any')
url="http://cinnamon-spices.linuxmint.com/applets/view/17"
license=('GPL')
depends=('cinnamon' 'gtk3' 'dconf')
install=$pkgname.install
source=('http://cinnamon-spices.linuxmint.com/uploads/applets/13DC-XIEX-4K5T.zip')
md5sums=('b9bff7535208772dffcfd0e2ade76640')

build() {
	cd ${srcdir}/cinnamon-weather-${pkgver}/
	
	uuid="weather@mockturtl"
	cinnamon_dir="${pkgdir}/usr/share/cinnamon/applets/${uuid}"
	bin_dir="${pkgdir}/usr/bin"
	gschema_dir="${pkgdir}/usr/share/glib-2.0/schemas"
	language_dir="${pkgdir}/usr/share/locale"

	mkdir -p ${cinnamon_dir}
	mkdir -p ${bin_dir}
	mkdir -p ${gschema_dir}
	
	#patch for global locale for this applet
	sed -i 's|(UUID, GLib.get_home_dir() +"/.local/share/locale");|(UUID, "/usr/share/locale");|' "applet.js"
	
	install -m0644 metadata.json applet.js icon.png stylesheet.css ${cinnamon_dir}
	install -m0644 org.cinnamon.applets.weather@mockturtl.gschema.xml ${gschema_dir}
	install -m0755 cinnamon-weather-settings ${bin_dir}
	
	cd po
	for file in *.po ;do {
     folder=${file%.*}
	 mkdir -p "$language_dir/${folder}/LC_MESSAGES"
	 msgfmt "${file}" -o "$language_dir/${folder}/LC_MESSAGES/${uuid}.mo"
	}
	done
}
