diff --git a/util/grub-mkstandalone.in b/util/grub-mkstandalone.in
index 3cb3eb3..52a045d 100644
--- a/util/grub-mkstandalone.in
+++ b/util/grub-mkstandalone.in
@@ -140,18 +140,19 @@ if [ "x${format}" = x ] ; then
   exit 1
 fi
 
+target_cpu="`echo ${format} | awk -F - '{ print $1; }'`"
+platform="`echo ${format} | awk -F - '{ print $2; }'`"
+
 if [ "x$source_directory" = x ] ; then
-    cpu="`echo $format | awk -F - '{ print $1; }'`"
-    platform="`echo $format | awk -F - '{ print $2; }'`"
-    case "$platform" in
+    case "${platform}" in
 	yeeloong | fuloong | fuloong2f | fuloong2e)
 	    platform=loongson ;;
     esac
-    case "$cpu-$platform" in
+    case "${target_cpu}-${platform}" in
 	mips-loongson)
 	    cpu=mipsel ;;
     esac
-    source_directory="${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/$cpu-$platform"
+    source_directory="${libdir}/$(echo ${PACKAGE_TARNAME} | sed ${transform})/${target_cpu}-${platform}"
 fi
 
 set $grub_mkimage dummy
@@ -163,17 +164,17 @@ else
 fi
 
 memdisk_dir="`mktemp -d "${TMPDIR:-/tmp}/tmp.XXXXXXXXXX"`" || exit 1
-mkdir -p "${memdisk_dir}"/boot/grub
+mkdir -p "${memdisk_dir}"/boot/grub/"${target_cpu}-${platform}"/
 
 for file in "${source_directory}/"*.mod "${source_directory}/"efiemu32.o "${source_directory}/"efiemu64.o; do
     if test -f "$file"; then
-        cp -f "$file" "${memdisk_dir}"/boot/grub/
+        cp -f "$file" "${memdisk_dir}"/boot/grub/"${target_cpu}-${platform}"/
     fi
 done
 
 for file in ${pkglib_DATA}; do
     if test -f "${source_directory}/${file}"; then
-        cp -f "${source_directory}/${file}" "${memdisk_dir}"/boot/grub/
+        cp -f "${source_directory}/${file}" "${memdisk_dir}"/boot/grub/"${target_cpu}-${platform}"/
     fi
 done
 
diff --git a/util/grub.d/00_header.in b/util/grub.d/00_header.in
index d9bcc15..60360cb 100644
--- a/util/grub.d/00_header.in
+++ b/util/grub.d/00_header.in
@@ -85,10 +85,21 @@ EOF
 else
     # Insert all available backends; GRUB will use the most appropriate.
     have_video=0;
-    for backend in $(cat "${GRUB_PREFIX}/video.lst"); do
-	have_video=1;
-	cat <<EOF
-  insmod ${backend}
+    targets="$(ls -1 "${GRUB_PREFIX}" | grep '/' | sed "s|/||g")"
+    for target in ${targets}; do
+        platform="$(echo ${target} | awk -F - '{ print $2; }')"
+        cat <<EOF
+  if [ "\${grub_platform}" == "${platform}" ]; then
+EOF
+        for backend in $(cat "${GRUB_PREFIX}/${target}/video.lst"); do
+            have_video=1;
+            cat <<EOF
+    insmod ${backend}
+EOF
+        done
+    cat <<EOF
+  fi
+  
 EOF
     done
     if [ x$have_video = x0 ]; then
