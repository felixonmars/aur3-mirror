# Contributor: Julien MISCHKOWITZ <wain@archlinux.fr>
# Contributor: Alessio Biancalana <dottorblaster@gmail.com>
# Contributor: ShadowKyogre <shadowkyogre@aim.com>

pkgname=compiz-boxmenu
pkgver=1.0.9
pkgrel=1
pkgdesc="A desktop menu for compiz, forked from compiz-deskmenu by crdlb. Introduces extensive icon support, pipeitems, recent documents list, and more"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/compizboxmenu/"
license=('GPL')
depends=('libwnck' 'python-lxml' 'pyxdg' 'pygtk' 'dbus-glib' 'gtk2')
makedepends=('intltool' 'pkgconfig' 'gettext')
provides=('compiz-boxmenu_no-dbus' 'compiz-deskmenu')
conflicts=('compiz-boxmenu_no-dbus')
install=$pkgname.install
source=(http://master.dl.sourceforge.net/project/compizboxmenu/source%20snapshots/${pkgname}_-_${pkgver}.tar.gz)
md5sums=('a2e7d6f21b6de23044e71e5f551f256b')

build() {
  cd ${srcdir}/${pkgname}
  sed -i -e 's|#!/usr/bin/env python|#!/usr/bin/env python2|' {compiz-boxmenu-editor,autoconfig-compiz.py}
  
  msg "Starting make..."
  make || return 1
}

package() {
  cd ${srcdir}/${pkgname}
  make DESTDIR=$pkgdir install || return 1
  install -m 755 $srcdir/$pkgname/autoconfig-compiz.py $pkgdir/usr/bin/compiz-boxmenu-autoconfig || return 1
  chmod 0644 $pkgdir/etc/xdg/compiz/boxmenu/menu.xml
  chmod 0644 $pkgdir/etc/xdg/compiz/boxmenu/precache.ini
  chmod 0644 $pkgdir/usr/share/dbus-1/services/org.compiz_fusion.boxmenu.service
}
