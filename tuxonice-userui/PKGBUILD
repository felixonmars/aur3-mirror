pkgname=tuxonice-userui
pkgver=1.1rc2
pkgrel=2
pkgdesc="TuxOnIce userspace user interface"
url="http://www.tuxonice.net/"
license=("GPL")
install=tuxonice-userui.install
arch=('i686' 'x86_64')
depends=('bash' 'libmng' 'libpng' 'libjpeg' 'lcms' 'freetype2')
makedepends=('git')
options=('!makeflags')
source=(userui-install userui-hook pm-utils-hook Makefile.diff)

_gitroot=git://git.tuxonice.net/tuxonice-userui.git
_gitname=tuxonice-userui
_gitref=6befcbbfc5052f95e5e258a34107fb987f06b6dc

build() {
  cd ${srcdir}
  msg "Connecting to GIT server..."

  if [ -d ${srcdir}/$_gitname ]; then
    cd $_gitname && git fetch origin
    msg "The local files are updated."
  else
    git clone --bare $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  if [ -d ${srcdir}/$_gitname-build ]; then
    rm -rf ${srcdir}/$_gitname-build
  fi

  git clone --no-checkout ${srcdir}/$_gitname ${srcdir}/$_gitname-build
  cd ${srcdir}/$_gitname-build
  git checkout $_gitref -- .

  patch -p1 < $srcdir/Makefile.diff
  make
}

package () {
  cd ${srcdir}/${_gitname}-build

  install -D -m644 $srcdir/userui-install $pkgdir/lib/initcpio/install/userui
  install -D -m644 $srcdir/userui-hook $pkgdir/lib/initcpio/hooks/userui
  install -D -m755 $srcdir/pm-utils-hook $pkgdir/etc/pm/sleep.d/80tuxonice-userui
  make DESTDIR=$pkgdir PREFIX=/usr install
}

md5sums=('a8e8ecb03e319321713652e25bc34a98'
         '96a359994273ab0e8baa198914ef0433'
         '2f20475979c45787120f7f0b0270a523'
         '7e328313d5afacdb9be77128986f5924')
