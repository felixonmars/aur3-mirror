# Contributor: TuxSpirit<tuxspiritATarchlinuxDOTfr> 

pkgname=peazip-qt 
pkgver=4.5
_namefile=peazip-$pkgver.LINUX.Qt
_namedest=peazip
pkgrel=1
pkgdesc="QT archiver utility (FINAL VERSION)" 
arch=('i686' 'x86_64')
url="http://www.peazip.org/peazip-linux.html" 
license=('LGPL') 
depends=('gdk-pixbuf' 'p7zip' 'quad' 'balz' 'unace' 'upx' 'curl') 
if [ "$CARCH" = "i686" ]; then
     depends[7]='gmp4'
     depends[8]='qt' 
elif [ "$CARCH" = "x86_64" ]; then
     depends[7]='lib32-gmp4' 
     depends[8]='lib32-qt' 
fi
replaces=('peazip-portable-qt' 'peazip-portable-beta-qt' 'peazip-beta-qt')
conflicts=('peazip-portable-qt' 'peazip-gtk1' 'peazip-portable-gtk1' 'peazip-gtk2' 'peazip-portable-gtk2' 'peazip-beta-gtk2' 'peazip-gtk2') 
install=${pkgname}.install
source=(http://peazip.googlecode.com/files/$_namefile.tgz)
    
md5sums=('413d76dd8421b5f88fec22eeff4f0793')

build() { 
	  
  # Addtional structures  
  install -d -m 755 ${pkgdir}/usr/lib/${_namedest}/res 
  install -d -m 755 ${pkgdir}/usr/lib/${_namedest}/res/{7z,arc,icons,lang,lpaq,paq,quad,themes,unace,upx,zpaq} 
  install -d -m 755 ${pkgdir}/usr/lib/${_namedest}/res/7z/Codecs 
  install -d -m 755 ${pkgdir}/usr/lib/${_namedest}/res/themes/{nographic-embedded,seven-embedded} 
  
  if [ "$CARCH" = "x86_64" ]; then
     install -d -m 755 ${pkgdir}/usr/lib32/${_namedest}
  fi

  #Program
  install -D -m 755 ${srcdir}/usr/local/share/PeaZip/peazip ${pkgdir}/usr/lib/${_namedest}/peazip

  # Additional files
  # lib
  if [ "$CARCH" = "i686" ]; then
        install -m 644 ${srcdir}/usr/local/share/PeaZip/libQt4Pas.so ${pkgdir}/usr/lib/${_namedest}/libQt4Pas.so  
  elif [ "$CARCH" = "x86_64" ]; then
        install -m 644 ${srcdir}/usr/local/share/PeaZip/libQt4Pas.so ${pkgdir}/usr/lib32/${_namedest}/libQt4Pas.so
  fi

  # res 
  install -m 755 ${srcdir}/usr/local/share/PeaZip/res/{altconf.txt,pea,pealauncher,rnd} ${pkgdir}/usr/lib/${_namedest}/res 
  # - peazip_help.pdf not available
  # install -m 644 ${srcdir}/usr/local/share/PeaZip/peazip_help.pdf ${pkgdir}/usr/lib/${_namedest}/res/peazip_help.pdf
 
  # icons
  install -m 644 ${srcdir}/usr/local/share/icons/peazip.png ${pkgdir}/usr/lib/${_namedest}/res/icons/peazip.png

  # Lang 
  install -m 644 ${srcdir}/usr/local/share/PeaZip/res/lang/* ${pkgdir}/usr/lib/${_namedest}/res/lang/ 
  
  # arc
  install -m 755 ${srcdir}/usr/local/share/PeaZip/res/arc/arc* ${pkgdir}/usr/lib/${_namedest}/res/arc/ 
  install -m 755 ${srcdir}/usr/local/share/PeaZip/res/arc/freearc* ${pkgdir}/usr/lib/${_namedest}/res/arc/  

  # lpaq 
  install -m 755 ${srcdir}/usr/local/share/PeaZip/res/lpaq/lpaq* ${pkgdir}/usr/lib/${_namedest}/res/lpaq/ 

  # paq 
  install -m 755 ${srcdir}/usr/local/share/PeaZip/res/paq/paq* ${pkgdir}/usr/lib/${_namedest}/res/paq/ 

  # Theme - nographic-embedded
  install -m 644 ${srcdir}/usr/local/share/PeaZip/res/themes/nographic-embedded/* ${pkgdir}/usr/lib/${_namedest}/res/themes/nographic-embedded/ 
  #       - seven-embedded
  install -m 644 ${srcdir}/usr/local/share/PeaZip/res/themes/seven-embedded/* ${pkgdir}/usr/lib/${_namedest}/res/themes/seven-embedded/
  #       - 7z archives
  install -m 644 ${srcdir}/usr/local/share/PeaZip/res/themes/*.7z ${pkgdir}/usr/lib/${_namedest}/res/themes/

  # zpac
  install -m 644 ${srcdir}/usr/local/share/PeaZip/res/zpaq/* ${pkgdir}/usr/lib/${_namedest}/res/zpaq/

  # Users - Desktop 
  install -D -m 644 ${srcdir}/usr/local/share/applications/PeaZip.desktop ${pkgdir}/usr/share/applications/peazip.desktop 

  #Fix peazip.desktop : icon, name
  sed -i "s|Icon=peazip.png|Icon=/usr/lib/peazip/res/icons/peazip.png|" ${pkgdir}/usr/share/applications/peazip.desktop || return 1
  sed -i "s|peazip.desktop|PeaZip|" ${pkgdir}/usr/share/applications/peazip.desktop || return 1
} 

