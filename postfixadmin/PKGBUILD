# Contributor: Filip <fila@pruda.com>

pkgname=postfixadmin
pkgver=2.3.4
pkgrel=1
pkgdesc="web based interface used to manage mailboxes, virtual domains and aliases created for Postfix"
arch=('any')
license=('GPL')
url="http://postfixadmin.sourceforge.net/"
backup=(etc/webapps/postfixadmin/config.inc.php etc/webapps/postfixadmin/.htaccess)
depends=('php' 'mysql-clients')

source=(http://downloads.sourceforge.net/project/postfixadmin/postfixadmin/postfixadmin-$pkgver/postfixadmin_$pkgver.tar.gz)
md5sums=('321f4f2d65a15b97dc384d8554264eba')

build() {

  _destdir=$pkgdir/usr/share/webapps/postfixAdmin
  _destdir_etc=$pkgdir/etc/webapps/postfixadmin
  _destdir_doc=$pkgdir/usr/share/doc/postfixadmin
  
  install -dm755 ${_destdir}
  install -dm755 ${_destdir_etc}
  install -dm755 ${_destdir_doc}
  
  cd $srcdir/$pkgname-$pkgver
  cp -r * ${_destdir}
  
  #etc
  mv ${_destdir}/config.inc.php ${_destdir_etc}
  ln -s /etc/webapps/postfixadmin/config.inc.php ${_destdir}/config.inc.php
  echo "#deny from all" >${_destdir_etc}/.htaccess || return 1
  ln -s /etc/webapps/postfixadmin/.htaccess ${_destdir}/.htaccess
  
  #move documents
  mv ${_destdir}/*.TXT ${_destdir_doc}
  mv ${_destdir}/tests ${_destdir_doc}
  mv ${_destdir}/ADDITIONS ${_destdir_doc}
  mv ${_destdir}/DOCUMENTS ${_destdir_doc}
  mv ${_destdir}/VIRTUAL_VACATION ${_destdir_doc}
  rm -rf ${_destdir}/debian
  
  # apache  
  cat >${_destdir_etc}/apache.example.conf <<EOF
        Alias /postfixAdmin "/usr/share/webapps/postfixAdmin"
        <Directory "/usr/share/webapps/postfixAdmin">
                AllowOverride All
                Options FollowSymlinks
                Order allow,deny
                Allow from all
        </Directory>
EOF
  
}
