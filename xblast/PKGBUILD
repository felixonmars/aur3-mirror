# Contributor: Jacob Bang <julemand101@gmail.com>

pkgname=xblast
pkgver=2.10.4
pkgrel=3
pkgdesc="XBlast is a multi-player arcade game inspired by the video/computer game Bomberman"
url="http://xblast.sourceforge.net/"
arch=('i686' 'x86_64')
license="GPL"
depends=('libpng' 'glibc' 'libx11' 'libice' 'zlib' 'libxau' 'libxdmcp')
source=(http://prdownloads.sourceforge.net/sourceforge/xblast/$pkgname-$pkgver.tar.gz
	http://prdownloads.sourceforge.net/sourceforge/xblast/images-2005-01-06.tar.gz
	http://prdownloads.sourceforge.net/sourceforge/xblast/levels-2005-01-06.tar.gz
	http://prdownloads.sourceforge.net/sourceforge/xblast/models-2005-01-06.tar.gz
	http://prdownloads.sourceforge.net/sourceforge/xblast/musics-2005-01-06.tar.gz
	http://prdownloads.sourceforge.net/sourceforge/xblast/sounds.tar.gz
	Makefile.am.patch)

md5sums=('eca7620c34ab49bb62fa8ef01f73b2f3' 'f92d0965c759695e6a18310f885c6f40'
	 'ea6277af0e97ad7eaea09370f4fe55ba' '887e84c9e7844823e3c8b59e63e8859b'
	 'e721a2e448f81ca83d9a0a772251f611' '809c27f1002ad4d7aa836e083f52a199'
	 '83a0c7dfd276f21e3c70dfb063a0b0ce')

build() {
  cd $startdir/src/$pkgname-$pkgver

  mkdir -p image/
  mkdir -p level/
  mkdir -p image/sprite/
  mkdir -p sounds/

  cp -r ../images-2005-01-06/* image/
  cp -r ../levels-2005-01-06/* level/
  cp -r ../models-2005-01-06/* image/sprite/
  cp -r ../musics-2005-01-06/* sounds/
  cp -r ../sounds/* sounds/

  patch -Np0 -i ../Makefile.am.patch || return 1

  ./autogen.sh
  ./configure --enable-sound --enable-SMPF --prefix=/usr/share/xblast --with-otherdatadir=/usr/share/xblast

  make || return 1
  make prefix=$startdir/pkg/usr install

  mkdir -p $startdir/pkg/usr/share/xblast/image
  mkdir -p $startdir/pkg/usr/share/xblast/level
  mkdir -p $startdir/pkg/usr/share/xblast/sounds
  cp -r image/* $startdir/pkg/usr/share/xblast/image
  cp -r level/* $startdir/pkg/usr/share/xblast/level
  cp -r sounds/* $startdir/pkg/usr/share/xblast/sounds
  
  find $startdir/pkg/usr/share/xblast/ -name Imakefile -type f | xargs /bin/rm -f
}
