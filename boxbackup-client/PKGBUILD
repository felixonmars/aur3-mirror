# Contributor: Andreas Schrafl <aschrafl@jetnet.ch>
# based on the work of Jaroslav Lichtblau <tu@dragonlord.cz>
# based on the work of KyAnh, http://kyanh.net/ <xkyanh@gmail.com>

pkgname=boxbackup-client
pkgver=0.11rc8
pkgrel=0
pkgdesc="An open source, completely automatic on-line backup system for UNIX."
arch=('i686' 'x86_64')
url="http://boxbackup.org"
license=('BSD')
depends=('openssl' 'perl' 'zlib')
backup=('etc/boxbackup/bbstored.conf')
source=(http://boxbackup.org/svn/box/packages/boxbackup-$pkgver.tgz bbclient)

md5sums=('c88405ed90de0f032b783f6a66fdb28d'
         '7b8f75b84d277f21923d4e1a6a050105')

build() {
	cd ${srcdir}/boxbackup-${pkgver}

	./bootstrap
	./configure

	mkdir -p ${srcdir}/boxbackup-${pkgver}/parcels/boxbackup-${pkgver}-backup-client-linux-gnu

	make release/bin/bbackupd/bbackupd
	make release/bin/bbackupd/bbackupd
	cp ${srcdir}/boxbackup-${pkgver}/release/bin/bbackupd/bbackupd ${srcdir}/boxbackup-${pkgver}/parcels/boxbackup-${pkgver}-backup-client-linux-gnu/bbackupd

	make release/bin/bbackupquery/bbackupquery
	cp ${srcdir}/boxbackup-${pkgver}/release/bin/bbackupquery/bbackupquery ${srcdir}/boxbackup-${pkgver}/parcels/boxbackup-${pkgver}-backup-client-linux-gnu/bbackupquery

	make release/bin/bbackupctl/bbackupctl
	cp ${srcdir}/boxbackup-${pkgver}/release/bin/bbackupctl/bbackupctl ${srcdir}/boxbackup-${pkgver}/parcels/boxbackup-${pkgver}-backup-client-linux-gnu/bbackupctl

	cp ${srcdir}/boxbackup-${pkgver}/bin/bbackupd/bbackupd-config ${srcdir}/boxbackup-${pkgver}/parcels/boxbackup-${pkgver}-backup-client-linux-gnu/bbackupd-config

  for f in \
    bbackupd \
    bbackupquery \
    bbackupctl \
    bbackupd-config ;\
  do
      install -D -m755 \
        ${srcdir}/boxbackup-$pkgver/parcels/boxbackup-$pkgver-backup-client-linux-gnu/$f \
        ${pkgdir}/usr/bin/$f
  done

  install -D -m755 "${srcdir}/bbclient" "${pkgdir}/etc/rc.d/bbclient"
}
