# Original firehol contributors:
#    Jakob Gruber <jakob.gruber@gmail.com>
#    Geoffroy Carrier <geoffroy.carrier@koon.fr>
#    Filip Dvorak <fila@pruda.com>
# Maintainer: SanskritFritz (gmail)

pkgname=sanewall
pkgver=0.9.1
pkgrel=1
pkgdesc='Fork of Firehol (the iptables stateful packet filtering firewall builder)'
url="http://www.sanewall.org/"
arch=('any')
license=('GPL')
depends=('iptables' 'gawk' 'iproute')
backup=('etc/sanewall/sanewall.conf')
#conflicts=('firehol')
install='sanewall.install'
source=("http://download.sanewall.org/releases/sanewall-${pkgver}.tar.gz")
md5sums=('1b919a30183b26f2b912e446005abe0d')

build() {
  cd ${srcdir}
  true
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  install -d ${pkgdir}/etc/sanewall{,/examples}
  install -d ${pkgdir}/usr/share/man/man{1,5}
  install -d ${pkgdir}/usr/share/doc/sanewall

  install -D -m744 sanewall ${pkgdir}/etc/rc.d/sanewall
  install -D -m744 get-iana.sh ${pkgdir}/etc/sanewall/
  install -D -m744 check-iana.sh ${pkgdir}/etc/sanewall/
  install -D -m744 adblock.sh ${pkgdir}/etc/sanewall/
  install -D -m644 etc/RESERVED_IPS ${pkgdir}/etc/sanewall/

  install -D -m644 examples/*.conf ${pkgdir}/etc/sanewall/examples/

  install -D -m644 README ${pkgdir}/usr/share/doc/sanewall/
  install -D -m644 COPYING ${pkgdir}/usr/share/doc/sanewall/
  install -D -m644 INSTALL ${pkgdir}/usr/share/doc/sanewall/
  install -D -m644 doc/* ${pkgdir}/usr/share/doc/sanewall/

  install -D -m644 man/man1/sanewall.1 ${pkgdir}/usr/share/man/man1/
  install -D -m644 man/man1/get-iana.1 ${pkgdir}/usr/share/man/man1/
  install -D -m644 man/man5/sanewall.conf.5 ${pkgdir}/usr/share/man/man5/

  # backup does not work if the file is not contained in the package
  # plus, creating it in post_install will set 777 permissions and we dont want that

  touch ${pkgdir}/etc/sanewall/sanewall.conf
  chmod 600 ${pkgdir}/etc/sanewall/sanewall.conf
}
