# Contributor: Jed Brown <jed@59A2.org>

pkgname=cedet-bzr
pkgver=8234
pkgrel=1
pkgdesc="Collection of Emacs Development Enviromnent Tools (Bazaar version)"
arch=('any')
url="http://cedet.sourceforge.net/"
license=('GPL')
conflicts=('cedet' 'cedet-cvs')
provides=('cedet')
depends=('emacs')
makedepends=('bzr')
source=('cedet-bzr.install')
md5sums=('8c7910a88fc3f03da13aed12d1cfbedf')
install=$pkgname.install

_bzrtrunk='bzr://cedet.bzr.sourceforge.net/bzrroot/cedet/code/trunk'
_bzrmod=cedet

build() {
  cd "$srcdir"

  msg "Connecting to BZR server...."
  if [ -d $_bzrmod/.bzr ]; then
    (cd $_bzrmod && bzr update -v)
    msg "BZR update done or server timeout"
  else
    bzr checkout --lightweight $_bzrtrunk $_bzrmod
    msg "BZR checkout done or server timeout"
  fi
  msg "Starting build ..."

  rm -rf ${_bzrmod}-build
  cp -a ${_bzrmod} ${_bzrmod}-build
  cd ${_bzrmod}-build

  make PREFIX=$pkgdir/usr

  install -d $pkgdir/usr/share/emacs/site-lisp/cedet
  for _module in cogre common contrib ede eieio quickpeek semantic speedbar srecode; do
    cp -a $_module $pkgdir/usr/share/emacs/site-lisp/cedet
  done

  install -d $pkgdir/usr/share/info
  make PREFIX=$pkgdir/usr INSTALL_INFO=install-info install-info
}
