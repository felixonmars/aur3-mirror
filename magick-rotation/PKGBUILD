# Maintainer: Lars Jacob <lars+aur at jaclar dot net>
pkgname=magick-rotation
pkgver=1.5
pkgrel=2
pkgdesc="An autorate helper for tablet pc's like Lenovo, HP, Dell tablets"
arch=('i686' 'x86_64')
if test "$CARCH" == x86_64; then
  bit=64
else
  bit=32
fi
url=https://launchpad.net/magick-rotation/
license=('GPL2')
install="$pkgname.install"
depends=('xorg-xrandr' 'udev' 'xdg-utils' 'pygtk')
source=("https://launchpad.net/$pkgname/trunk/$pkgver/+download/$pkgname-$pkgver.tar.bz2" "$pkgname.install" "$pkgname.desktop")
md5sums=('4a42f3a92f62c52f22ecb3fe414b2e7a'
         'd1983f7e7e20ff080b956da8fd4f777e'
         '76cae3a82c187f3ef43caac67bd06524')

build () {
  cd "$srcdir/$pkgname"
  gcc check.c -o "checkmagick$bit" -lX11 -lXrandr
  find . -type f | xargs sed -i 's@^#!.*python$@#!/usr/bin/python2@'
}

package() {
  install -d "$pkgdir/etc/xdg/autostart"
  install -m 644 "$pkgname.desktop" "$pkgdir/etc/xdg/autostart/"

  cd "$srcdir/$pkgname"

  # binaries
  install -d "$pkgdir/usr/bin"
  install -m 755 "checkmagick$bit" "$pkgdir/usr/bin/"

  # udev rules
  install -d "$pkgdir/etc/udev/rules.d"
  install -m 644  62-magick.rules "$pkgdir/etc/udev/rules.d/"

  # Python Files
  install -d "$pkgdir/usr/share/$pkgname"
  install -m 644 ChangeLog "$pkgdir/usr/share/$pkgname/"
  install -m 755 config.py "$pkgdir/usr/share/$pkgname/"
  install -m 755 debug.py "$pkgdir/usr/share/$pkgname/"
  install -m 755 gui_gtk.py "$pkgdir/usr/share/$pkgname/"
  install -m 755 hinge.py "$pkgdir/usr/share/$pkgname/"
  install -m 755 listener.py "$pkgdir/usr/share/$pkgname/"
  install -m 755 magick-rotation "$pkgdir/usr/share/$pkgname/"
  install -m 755 oem_wmi.py "$pkgdir/usr/share/$pkgname/"
  install -m 755 xrotate.py "$pkgdir/usr/share/$pkgname/"

  # Icons
  cd MagickIcons
  install -d "$pkgdir/usr/share/$pkgname/MagickIcons"
  install -m 644 MagickAbout.png "$pkgdir/usr/share/$pkgname/MagickIcons/"
  install -m 644 magick-rotation-disabled.png "$pkgdir/usr/share/$pkgname/MagickIcons/"
  install -m 644 magick-rotation-disabled-touchoff.png "$pkgdir/usr/share/$pkgname/MagickIcons/"
  install -m 644 magick-rotation-enabled.png "$pkgdir/usr/share/$pkgname/MagickIcons/"
  install -m 644 magick-rotation-enabled-touchoff.png "$pkgdir/usr/share/$pkgname/MagickIcons/"
}
