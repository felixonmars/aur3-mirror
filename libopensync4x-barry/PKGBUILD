# Maintainer: Thibi <thibitian [at] gmail.com>
# Contributor: Sergej Pupykin
# Contributor: Hauke Wesselmann <hauke@h-dawg.de>
# Contributor: Laurie Clark-Michalek <bluepeppers@archlinux.us>

pkgname=libopensync4x-barry
_realname=libopensync
pkgver=201205242346
pkgrel=1
pkgdesc="Barry snapshot of the 0.4x opensync synchronisation framework."
url='http://www.opensync.org'
license=('LGPL')
arch=('i686' 'x86_64')
makedepends=('python2' 'cmake' 'chrpath')
depends=('glib2' 'libxml2' 'sqlite3' 'libxslt')
conflicts=('libopensync')
source=("http://downloads.sourceforge.net/barry/binary-meta-snapshot-${pkgver}.tar.bz2")
md5sums=('68f83e1af245772b3ccc48d3c3a82066')

build() {
  mv ${srcdir}/binary-meta-snapshot-${pkgver}/sources/opensync/ $srcdir/$_realname-$pkgver
  cd $srcdir/$_realname-$pkgver
 
  #disable treating of warnings as errors
  find /$(pwd) -type f -exec sed -i 's/-Werror//g' '{}' \;
 
  mkdir build
  cd build
  cmake -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_MODULE_PATH="${srcdir}/binary-meta-snapshot-${pkgver}/sources/cmake-modules" \
    $srcdir/$_realname-$pkgver
  make
  make DESTDIR=$pkgdir install
 
  find $pkgdir -name \*.so  -type f -exec chrpath -d {} \;
  find $pkgdir -perm /ugo+x -type f -exec chrpath -d {} \;
}




