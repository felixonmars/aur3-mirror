# Maintainer: heinrich5991 <heinrich5991@gmail.com>
pkgname=leagueoflegends
pkgver=0.0.0
pkgrel=3
pkgdesc="A game by Riot"
arch=('i686' 'x86_64')
url="http://leagueoflegends.com/"
license=('custom')
depends=(winetricks)
makedepends=()
checkdepends=()
options=(!libtool)
install=leagueoflegends.install
source=("http://sourceforge.net/projects/wine/files/Source/wine-1.5.16.tar.bz2"
        "wine-owner.patch"
        "lol.patch"
        "leagueoflegends"
        "http://l3cdn.riotgames.com/Installer/SingleFileInstall/LeagueOfLegendsBaseEUW.exe"
        "lol_setup.iss")

sha256sums=('2f4df6ade18d636c892bee0feb6fd075eb3ad299e61d250ea359659d6411e723'
            'f54f34e1607b9bf7cd27009fc3ce120b6f228e2efe3d5cf00531e695dfae079b'
            '72f63a256b55a046a81d6e0514f9391e5b6f282b0fecd7092af7d5116606b170'
            'a1056cb6800d0f63cd9dd33e2e09ac54afe4ac9dbd3ba2bed573fca352820217'
            '6365a39634ea37398a604555a6c21d4ecf7d49cb9a74715d10e4fa939f0453c4'
            'c7a82b96986474d06badbbee62c2bdc3ce9e3e10789c0d0cf3709f0ad38f2aff')

_wine_version=$(echo ${source[0]} | grep -Eo "([0-9]+\.){2}[0-9]+")

build() {
  cd "$srcdir/wine-$_wine_version/"
  for _patch in ${source[*]}; do
    if [[ "$_patch" == *".patch" ]]; then
      patch -p1 < "../$_patch"
    fi
  done
  ./configure --prefix=/usr
  make -j8
}

package() {
  install -dm755 "$pkgdir/opt"
  install -dm755 "$pkgdir/opt/lol"
  install -dm755 "$pkgdir/usr/bin"
  install -dm755 "$pkgdir/opt/lol/install"

  cd "$srcdir/wine-$_wine_version/"
  make DESTDIR="$pkgdir/opt/lol" install

#  find "$pkgdir/opt/lol/" -type d -exec chmod 775 "{}" \;
#  find "$pkgdir/opt/lol/" -type f -exec chmod 664 "{}" \;
#
  install -Dm754 "$srcdir/leagueoflegends" "$pkgdir/usr/bin/leagueoflegends"
  install -Dm644 "$srcdir/LeagueOfLegendsBaseEUW.exe" "$pkgdir/opt/lol/install/"
  install -Dm644 "$srcdir/lol_setup.iss" "$pkgdir/opt/lol/install/"
}

# vim:set ts=2 sw=2 et:
