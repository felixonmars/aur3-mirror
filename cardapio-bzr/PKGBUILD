# Contributor : max.bra <max dot bra at alice dot it>
# Maintainer : Shanto <shanto at hotmail>

pkgname=cardapio-bzr
_pkgname=cardapio
_bzrmod=cardapio
_bzrtrunk=https://launchpad.net/cardapio/trunk
pkgver=765
pkgrel=2
pkgdesc="An alternative Gnome menu, launcher, and much more!"
arch=('any')
url="https://launchpad.net/cardapio"
license=('GPL3')
conflicts=('cardapio')
provides=('cardapio')
depends=('pyxdg' 'xdg-user-dirs' 'dbus-python' 'gnome-python-desktop' 'python-keybinder' 'python-simplejson' 'gnome-control-center' 'tk')
makedepends=('bzr')
optdepends=('gnome-panel: for applet-mode use'
            'tracker: search capability'
            'alacarte: menu editing'
            'docky: docky integration'
            'awn: awn integration')
source=(arch_and_python_stuff.patch)
md5sums=('73ff068d5b13c68a6d8db45d071620ca')

build() {
  cd "${srcdir}"
  msg "Connecting to Bazaar server...."

  if [ -d $_bzrmod ] ; then
    cd ${_bzrmod} && bzr --no-plugins pull ${_bzrtrunk} -r ${pkgver}
    msg "The local files are updated."
  else
    bzr --no-plugins branch ${_bzrtrunk} ${_bzrmod} -q -r ${pkgver}
  fi

  msg "Bazaar checkout done or server timeout"

  msg "Removing old build directory..."
  rm -rf $srcdir/$_bzrmod-build
  msg "Creating build directory..."
  cp -r $srcdir/$_bzrmod $srcdir/$_bzrmod-build
  
  msg "Arch and Python2 adjustments..."
  cd "${srcdir}/$_bzrmod-build"
  patch -uNp2 -r- -i ../arch_and_python_stuff.patch || return 1
}

package() {
  msg "Building cardapio...."
  cd "${srcdir}/${_pkgname}-build/${_pkgname}"
  make DESTDIR="'${pkgdir}'" install || return 1

  ln -s "/usr/lib/cardapio/cardapio" "$pkgdir/usr/bin/"
  ln -s "/usr/lib/cardapio/cardapio-gnome-panel-applet" "$pkgdir/usr/bin/"

  msg "Building cardapio-docky...."
  cd "${srcdir}/${_pkgname}/${_pkgname}-docky"
  make DESTDIR="'${pkgdir}'" install || return 1

  msg "Building cardapio-awn...."
  cd "${srcdir}/${_pkgname}/${_pkgname}-awn"
  make DESTDIR="'${pkgdir}'" install || return 1

  msg "Cleaning package...."
  rm "${pkgdir}"/usr/share/locale/cardapio.pot || return 1
}

