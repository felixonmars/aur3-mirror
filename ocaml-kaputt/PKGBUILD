# Maintainer: Serge Zirukin <ftrvxmtrx@gmail.com>
# Contributor: Sergei Lebedev <superbobry@gmail.com>

pkgname=ocaml-kaputt
pkgver=1.1
pkgrel=3
pkgdesc="Unit testing tool for OCaml"
arch=('i686' 'x86_64')
url=("http://kaputt.x9c.fr")
license=('GPLv3')
depends=('ocaml')
makedepends=('ocaml-findlib')
_pkgname=kaputt
source=(http://kaputt.x9c.fr/distrib/${_pkgname}-${pkgver}.tar.gz
        makefile.patch)
md5sums=('d96e6b953f118952b517a7ef98dba055'
         'efe1f0c31a4f67f2ef1c412e2a39404b')

build () {
  cd "${srcdir}/${_pkgname}-${pkgver}"

  chmod +x ./configure
  ./configure -ocamlfind /usr/bin/ocamlfind || return 1
  make all || return 1
}

package () {
  cd "${srcdir}/${_pkgname}-${pkgver}"
  OCAMLFIND_DESTDIR="${pkgdir}$(ocamlfind printconf destdir)"

  # BUG: Makefile doesn't install `kaputt.cmi`.
  patch -Np0 < $startdir/makefile.patch

  mkdir -p $OCAMLFIND_DESTDIR
  OCAMLFIND_DESTDIR=$OCAMLFIND_DESTDIR make install || return 1
  install -D "doc/${_pkgname}.pdf" "${pkgdir}/usr/share/doc/${_pkgname}/${_pkgname}.pdf"
}
