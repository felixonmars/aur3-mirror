# Maintainer: Mikael Eriksson <mikael_eriksson@miffe.org>
# Contributor: Thomas Dziedzic < gostrc at gmail >
# Contributor: Christoph Zeiler <archNOSPAM_at_moonblade.dot.org>
# Contributor: Curtis Smith <kman922002@gmail.com>

pkgname=odamex
pkgver=0.6.0
pkgrel=1
pkgdesc='A free client/server multiplayer engine for the classic FPS Doom.'
arch=('i686' 'x86_64')
url='http://odamex.net/'
license=('GPL')
depends=('sdl_mixer>=1.2.6' 'wxgtk')
optdepends=('timidity++: Required for music')
source=("http://downloads.sourceforge.net/odamex/odamex-src-${pkgver}.tar.bz2"
        0001-Archlinux-timidity.cfg-path-fix.patch)
md5sums=('02c48e56355e48da65f8702088e9f811'
         'e99da965760ef27a036e18e54917db38')

build() {
	cd odamex-src-${pkgver}
  
  patch -p1 -i "$srcdir/0001-Archlinux-timidity.cfg-path-fix.patch"

	sed 's|getenv("DOOMWADPATH")|"/usr/share/doom"|g' -i {client,server}/src/d_main.cpp

	make CFLAGS="${CXXFLAGS} -DUNIX -DLINUX -DNOASM -Icommon" odamex odasrv

  cd odalaunch
  make
  cd ..

  install -Dm755 odamex "$pkgdir/usr/bin/odamex"
  install -Dm755 odasrv "$pkgdir/usr/bin/odasrv"
  install -Dm755 odalaunch/odalaunch "$pkgdir/usr/bin/odalaunch"
  install -Dm644 odamex.wad "$pkgdir/usr/share/doom/odamex.wad"
  install -Dm644 media/icon_odamex_96.png "$pkgdir/usr/share/pixmaps/odamex.png"
  install -Dm644 media/icon_odasrv_96.png "$pkgdir/usr/share/pixmaps/odasrv.png"
  install -Dm644 media/icon_odalaunch_96.png "$pkgdir/usr/share/pixmaps/odalaunch.png"
  install -Dm644 installer/arch/odamex.desktop "$pkgdir/usr/share/applications/odamex.desktop"
  install -Dm644 installer/arch/odasrv.desktop "$pkgdir/usr/share/applications/odasrv.desktop"
  install -Dm644 installer/arch/odalaunch.desktop "$pkgdir/usr/share/applications/odalaunch.desktop"
}

# vim:set ts=2 sw=2 et:
