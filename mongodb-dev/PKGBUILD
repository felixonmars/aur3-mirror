# Maintainer: Guan 'kuno' Qing <neokuno#gmail#com>(replaces # with .)

pkgname=mongodb-dev
pkgbasename=mongodb
pkgver=1.9.0
pkgrel=1
pkgdesc="A high-performance, open source, schema-free document-oriented database."
arch=('i686' 'x86_64')
url="http://www.mongodb.org"
license=('AGPL')
makedepends=(gcc scons)
depends=(boost spidermonkey pcre)
optdepends=('libpcap: needed for mongosniff')
backup=('etc/conf.d/mongodb' 'etc/mongodb.conf')
conflicts=(mongodb)
source=("${pkgbasename}-src-r${pkgver}.tar.gz::http://downloads.mongodb.org/src/${pkgbasename}-src-r${pkgver}.tar.gz"
        "mongodb.rc"
        "mongodb.conf")
install="mongodb.install"

build() {
    local SCONSFLAGS="$MAKEFLAGS"

    cd "${pkgbasename}-src-r${pkgver}"

    scons all || return 1
}

package() {
    cd "${pkgbasename}-src-r${pkgver}"

    scons install --prefix="$pkgdir/usr" || return 1

    install -Dm 755 "$startdir/mongodb.rc" "$pkgdir/etc/rc.d/mongodb"
    install -Dm 644 "$startdir/mongodb.conf" "$pkgdir/etc/mongodb.conf"
    install -dm 700 "$pkgdir/var/state/mongodb"

    if [ -d "$pkgdir/usr/lib64" ]
    then
        mv "$pkgdir/usr/lib64" "$pkgdir/usr/lib"
    fi
}
md5sums=('ebac4edc7ea133f3e83180e1e0d0b85d'
         '089892f44672eee186103867a787075e'
         '9e0ea3f96732bb7811f0b64dace56440')
