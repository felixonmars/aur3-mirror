# Submitter: David Rosenstrauch <darose@darose.net>
# Maintainer: Erik Mank <erik@braindisorder.org>
pkgname=tt-rss
pkgver=1.5.7
pkgrel=1
pkgdesc="Tiny Tiny RSS is an open source web-based news feed (RSS/Atom) aggregator, designed to allow you to read news from any location, while feeling as close to a real desktop application as possible."
arch=('any')
url="http://tt-rss.org/redmine/"
license=('GPL')
groups=()
depends=('php')
makedepends=()
optdepends=('apache' 'mysql' 'postgresql' 'php-curl')
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=tt-rss.install
changelog=
source=(http://tt-rss.org/download/$pkgname-$pkgver.tar.gz)
noextract=()
md5sums=('64d5c0c1ce3523de221e42f0d6f03d53')

#build() {
#}

package() {
 cd "$srcdir/$pkgname-$pkgver"

 install -d ${pkgdir}/srv/http/tt-rss
 cp -r * ${pkgdir}/srv/http/tt-rss/

 # make several directories writable by http user
 chmod g+w ${pkgdir}/srv/http/tt-rss/lock
 chgrp http ${pkgdir}/srv/http/tt-rss/lock

 chmod g+w ${pkgdir}/srv/http/tt-rss/feed-icons
 chgrp http ${pkgdir}/srv/http/tt-rss/feed-icons

 chmod -R g+w ${pkgdir}/srv/http/tt-rss/cache
 chgrp -R http ${pkgdir}/srv/http/tt-rss/cache

 chmod g+w ${pkgdir}/srv/http/tt-rss/lib/htmlpurifier/library/HTMLPurifier/DefinitionCache/Serializer
 chgrp http ${pkgdir}/srv/http/tt-rss/lib/htmlpurifier/library/HTMLPurifier/DefinitionCache/Serializer

# update SQL to use ENGINE instead of TYPE, to conform with MySQL5.5
find ${pkgdir} -type f -wholename "*mysql*sql" -exec sed -i s/TYPE=/ENGINE=/ {} \;
}
