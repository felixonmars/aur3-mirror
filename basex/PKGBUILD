# Maintainer: Christopher Heien <chris.h.heien@gmail.com>
# Contributor: Lazaros Koromilas <koromilaz@gmail.com>

pkgname=basex
pkgver=7.0
_altver=70
pkgrel=1
pkgdesc="High-performance XML database system and XPath/XQuery processor."
arch=('i686' 'x86_64')
url="http://basex.org/"
license=('BSD')
depends=('java-runtime')
source=("http://files.basex.org/releases/${pkgver}/BaseX${_altver}.zip" 
        "basex.sh" 
        "BaseX.desktop")
sha1sums=('1444b7c34455dd93d5a44bba2a817500b30f229f'
	  'b82c43d2f247d65b93b2f073543b8ceee038bfd1'
          '53eb192fe09410da5dff22ba7ecd5b26e5753fd7')

build() {
  # install profile.d script
  install -dm755 ${pkgdir}/etc/profile.d || return 1
  install -m755 ${srcdir}/${pkgname}.sh ${pkgdir}/etc/profile.d || return 1


  # Get the BASEX_HOME env var
  source ${srcdir}/${pkgname}.sh || return 1

  cd ${srcdir}
  install -dm755 ${pkgdir}/${BASEX_HOME}/{bin,lib,img} || return 1

  # install gui shortcuts

  install -dm755 ${pkgdir}/usr/share/applications || return 1 
  install -m755 BaseX.desktop ${pkgdir}/usr/share/applications || return 1
  jar -xf BaseX.jar img/icon.png
  install -m644 img/icon.png ${pkgdir}/${BASEX_HOME}/img || return 1	 

  install -m644 ./*.jar ${pkgdir}/${BASEX_HOME} || return 1
  install -m644 ./lib/*.jar ${pkgdir}/${BASEX_HOME}/lib || return 1
  cp -Rp ./etc ${pkgdir}/${BASEX_HOME} || return 1

  # Do not copy Windows .bat/.cmd files
  find ./bin -type f -a ! -name \*.bat -a ! -name \*.cmd \
    -exec install -m755 {} ${pkgdir}/${BASEX_HOME}/bin \; || return 1
}
