# Contributor: twa022 <twa022 at gmail dot com>

pkgname=dockbarx-bzr
_pkgname=dockbarx
pkgver=479
pkgrel=1
pkgdesc="GNOME TaskBar with groupping and group manipulation."
arch=('i686' 'x86_64')
url="https://code.launchpad.net/~dockbar-main/dockbar/experimental"
license=('GPL3')
depends=('python-wnck' 'python2' 'pyxdg' 'dbus-python' 'python2-numpy' 
         'python2-gconf' 'python-imaging' 'python-keybinder' 
         'hicolor-icon-theme' 'python-xlib')
optdepends=('avant-window-navigator: to use the AWN Dockbar Plugin'
            'zeitgeist: to have recently used file list'
            'compiz-fusion-plugins-main: opacify plugin'
            'dockmanager: dockmanager plugins')
makedepends=('bzr')
conflicts=('dockbarx' 'dockbarx-awn-applet-bzr')
replaces=('dockbarx-awn-applet-bzr')
provides=('dockbarx')
source=()
	
_bzrmod=$_pkgname
_bzrtrunk=https://code.launchpad.net/~dockbar-main/dockbar/experimental

build() {
  cd $startdir/src
  msg "Connecting to the server...."

  if [ -d ./$_bzrmod ]; then
    cd ./$_bzrmod && bzr up && cd ..
  else
    bzr co $_bzrtrunk $_bzrmod
  fi

  [ -d ./$_bzrmod-build ] && rm -fr ./$_bzrmod-build
  cp -r ./$_bzrmod ./$_bzrmod-build
  cd ./$_bzrmod-build

  cd ${srcdir}/${_pkgname}-build
  python2 setup.py install --root ${pkgdir}

  mkdir -p ${pkgdir}/usr/share/avant-window-navigator/applets
  cp -r AWN/* ${pkgdir}/usr/share/avant-window-navigator/applets
  
  mkdir -p ${pkgdir}/usr/share/pixmaps
  install -Dm644 ${srcdir}/${_pkgname}-build/icons/hicolor/128x128/apps/dockbarx.png ${pkgdir}/usr/share/pixmaps/dockbarx.png

  sed -i 's:^Categories=.*:Categories=GTK;GNOME;Settings;X-GNOME-PersonalSettings;:' ${pkgdir}/usr/share/applications/dbx_preference.desktop
  sed -i 's:/usr/bin/python:&2:' ${pkgdir}/usr/bin/{dockbarx_factory,dbx_preference,dockx}
}

