# Maintainer: Kozec <kozec at kozec dot com>

pkgname='pymclevel'
pkgver='0.1.6build299'
pkgrel=1
pkgdesc='Python library for reading Minecraft levels (stable version extracted from mcedit stable release)'
arch=('i686' 'x86_64')
url='https://github.com/mcedit/pymclevel'
license='BSD'

depends=('python2' 'python2-numpy' 'python2-yaml' 'python2-distribute')
makedepends=('cython2' 'unzip')
conflicts='pymclevel-git'

if [ $CARCH == "x86_64" ] ; then
	_mcarch="-amd64"
	_zipmd5="d72631f2acedb8e4de40d99512e351e4"
else
	_mcarch="32"
	_zipmd5="a4d9907b6943a23981d02847b7fca5e5"
fi

source=("pkg_resources.py" "setup_nbt.py" "setup.py"
	https://github.com/downloads/mcedit/mcedit/MCEdit_dev-${pkgver}.win${_mcarch}.zip
)

md5sums=('10a4fbe482363406ef92415feba9b0c7'
         'a9a64e15223c0f3d3b8d55bc59648534'
         '65b2fac91e451c3c61d484590422475d'
         ${_zipmd5})

build() {
	if [ -d ${srcdir}/build ] ; then
		msg "Removing old build dir"
		rm -R ${srcdir}/build
	fi
	mkdir -p ${srcdir}/build
	cd ${srcdir}/build
	msg "Extracting"
	unzip ../MCEdit_dev-${pkgver}.win${_mcarch}/library.zip 'pymclevel/*'

	msg "Compiling"
	cd pymclevel
	python2 ../../setup_nbt.py build_ext --inplace --force
	
	mkdir -p "build/lib/pymclevel"
	cp *.pyo "build/lib/pymclevel"
	cp -H ../../setup.py .
}


package() {
	cd ${srcdir}/build/pymclevel
	python2 setup.py install --root="${pkgdir}"
	
	mkdir -p "${pkgdir}/usr/share/pymclevel"
	cp *.yaml "${pkgdir}/usr/share/pymclevel"
	cp items.txt "${pkgdir}/usr/share/pymclevel"
	
	cp -L "${srcdir}/pkg_resources.py" "${pkgdir}/usr/lib/python2.7/site-packages/pymclevel"
}
