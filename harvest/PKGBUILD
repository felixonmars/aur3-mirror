# Maintainer: Magnus Bjerke Vik <mbvett at gmail dot com>
pkgname=harvest
pkgver=1.18
pkgrel=2
pkgdesc="Harvest: Massive Encounter is an rts game with battles of epic proportions."
arch=('i686' 'x86_64')
url="http://www.oxeyegames.com/harvest/"
license=('custom')
depends=('sfml' 'luajit' 'nvidia-cg-toolkit' 'freealut' 'libvorbis' 'gtk2' 'libjpeg6')
makedepends=('tar')
source=('harvest' 'harvest.desktop' 'harvest.png')
md5sums=('8424951b7f63697364bf5d744ec4d76d'
         '3157bf55bf86865e93560f6cb9c42bf1'
         'f9ab1cb5466cbf1738581443463c5d52')

_source_arch="i386"
[ "$CARCH" = "x86_64" ] && _source_arch="amd64"

_gamepkg="Harvest-${pkgver}_${_source_arch}.tar.gz"

build() {
	cd $srcdir

	msg "You'll need to download your full tar.gz package of Harvest, then specify absolute path to ${_gamepkg}:"
	read _pkgpath
	if [[ -f "${_pkgpath}/${_gamepkg}" ]]; then
		ln -sf "${_pkgpath}/${_gamepkg}"
	else
		error "Could not find package ${_pkgpath}/${_gamepkg}"
		return 1
	fi

	tar -zxf $_gamepkg

	install -D -m755 "${srcdir}/harvest" "${pkgdir}/usr/bin/harvest"

	install -d "${pkgdir}/opt/harvest/"
	rm -R ${srcdir}/Harvest/run_harvest ${srcdir}/Harvest/bin/
	cp -r ${srcdir}/Harvest/* ${pkgdir}/opt/harvest/

	install -D -m644 "${srcdir}/harvest.png" "${pkgdir}/usr/share/pixmaps/harvest.png"

	install -D -m644 "${srcdir}/harvest.desktop" "${pkgdir}/usr/share/applications/harvest.desktop"
}
