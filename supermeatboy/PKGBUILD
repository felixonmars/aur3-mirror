# Maintainer: Yochai Gal <yochaigal@gmail.com>
pkgname=supermeatboy
pkgver=20120607
_pkgver=06072012
pkgrel=4
pkgdesc="Super Meat Boy is a tough as nails platformer where you play as an animated cube of meat."
arch=('i686' 'x86_64')
url="http://www.supermeatboy.com/"
license=('custom')
depends=('openal' 'sdl')
makedepends=('unzip' 'tar')
source=('supermeatboy.desktop')
md5sums=('ceda8cdca2aaff63a9cae2ef7d7cf0d4')
PKGEXT='.pkg.tar'

_archive_md5="90a563ff103b4610b41af5fd2bccb21a"
_archive="supermeatboy-linux-${_pkgver}-bin"

build() {
  cd ${srcdir}

if [ ! -f ${smbarchivelocation}${_archive} ]; then
    if [ ! -f ${_archive} ] && [ -n "${_humblebundle4key}" ]; then
    rm -f ${_archive}* index.html\?key\=${_humblebundle4key}*
    wget http://www.humblebundle.com/?key=${_humblebundle4key}
    wget $(cat index.html\?key\=${_humblebundle4key} | grep "${_archive}" | cut -d "'" -f 10)
    mv ${_archive}* ${_archive}
          elif [ ! -f ${_archive} ] && [ -n "${_humblebundle5key}" ]; then
                rm -f ${_archive}* index.html\?key\=${_humblebundle5key}*
                wget http://www.humblebundle.com/?key=${_humblebundle5key}
                wget $(cat index.html\?key\=${_humblebundle5key} | grep "${_archive}" | cut -d "'" -f 10)
                mv ${_archive}* ${_archive}
    elif [ -z "${_humblebundle4key}" ] && [ -z "${_humblebundle5key}" ]; then
    echo You can now automate the download of the archive using the _humblebundle4key or _humblebundle5key bash variables.
    echo Just add \'export _humblebundle4key\=\<Your key here\>\' and/or
    echo \'export _humblebundle5key\=\<Your key here\>\' to \.bashrc
    echo
    echo Otherwise please just place ${_archive} into $(pwd)/
    echo Press Enter to continue
    read -a _unused
    fi
fi


  if [ ! -f ${_smbarchivelocation}${_archive} ]; then
    echo "${_smbarchivelocation}${_archive} not found!"
    return 1
  fi  

  if ! echo "${_archive_md5}  ${_smbarchivelocation}${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_smbarchivelocation}${_archive}"
    return 1
  fi

  rm -Rf ${srcdir}/smb/
  unzip -d ${srcdir}/smb/ ${_smbarchivelocation}${_archive} || true

  mkdir -p ${pkgdir}/opt/ ${pkgdir}/usr/share/applications/ \
    ${pkgdir}/usr/bin/
  cp -Tr ${srcdir}/smb/data ${pkgdir}/opt/supermeatboy/
  ln -s /opt/supermeatboy/SuperMeatBoy ${pkgdir}/usr/bin/supermeatboy
  cp ${srcdir}/supermeatboy.desktop ${pkgdir}/usr/share/applications/
  chmod a+r ${pkgdir}/usr/share/applications/supermeatboy.desktop
}

# vim: sts=2 ts=2 sw=2 et
