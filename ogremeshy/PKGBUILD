# Maintainer: Duong Pham <dthpham@gmail.com>

pkgname=ogremeshy
pkgver=1.1
pkgrel=1
pkgdesc="A tool for viewing OGRE mesh files"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/ogremeshy/"
license=('GPL3')
depends=('ogre>=1.7.3' 'wxgtk>=2.8')
makedepends=('cmake>=2.6.4')
install=$pkgname.install
source=(http://sourceforge.net/projects/$pkgname/files/OgreMeshy.$pkgver.src.tar.bz2 \
        ogremeshy-1.1-paths.diff \
        ogremeshy-1.1-resources.diff)
md5sums=('2273ebc2c998917929f6d9b8771ec4c9' \
         '9e9344d0c9783c16415d55457f29abbc' \
         '21c0294d38e60ecef7c7428d9af51a43')

build() {
  cd "$srcdir"

  msg "Applying patches..."
  cd src/Core && patch -p0 < ../../ogremeshy-1.1-paths.diff && cd "$srcdir" || return 1
  cd scripts/Resources && patch -p0 < ../../ogremeshy-1.1-resources.diff && cd "$srcdir" || return 1
  sed -i "s/wxWidgets COMPONENTS/wxWidgets COMPONENTS adv/g" CMakeLists.txt

  msg "Starting make..."
  mkdir -p build && cd build 
  cmake ..\
    -DCMAKE_MODULE_PATH=/usr/lib/OGRE/cmake
  make || return 1
}

package() {
  cd "$srcdir"

  cd scripts/Resources && sh copyresources.sh && cd -
  cp build/OgreMeshy bin/Release_Linux
  
  cd bin/Release_Linux
  sed -i "s/PluginFolder=Plugins/PluginFolder=\/usr\/lib\/OGRE/g" ~/.ogremeshy/Plugins.cfg

  install -d -m717 "${pkgdir}/opt/ogremeshy"
  install "$srcdir/bin/Release_Linux/OgreMeshy" "$pkgdir/opt/$pkgname"
  cp -R "$srcdir/bin/Release_Linux/Resources" "$pkgdir/opt/$pkgname"
}
