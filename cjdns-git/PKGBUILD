# Contributor: Prurigro
# Maintainer: Prurigro

pkgname=cjdns-git
pkgver=120405
pkgrel=1
pkgdesc="A routing engine designed for security, scalability, speed and ease of use."
url="https://github.com/cjdelisle/cjdns"
license="GPLv3"
depends=('libevent' 'iproute2' 'net-tools' 'sqlite3')
makedepends=('git' 'cmake' 'make' 'gcc')
arch=('i686' 'x86_64' 'armv7h')
install=${pkgname}.install

source=('cjdns.rc.d' 'cjdns.conf.d' 'cjdwebadmin.rc.d' 'cjdwebadmin.conf.d' 'cjdadmin')
sha1sums=('2c45ffe5302ae8a3876cf7f5f64dc319d944bc13'
         'b97f5802693042a45f06ffd3caa0e996230cfc62'
         '485dbd3805bd0754f9be7341cb9b33734744e199'
         'b71c09026d1cb54cb2ef580b309e88dcca837673'
         '9c2f122f7a287bf0e7d2cef3e842d9233017a96a')

build() {
  git clone https://github.com/cjdelisle/cjdns.git
  install -d cjdns/build
  pushd cjdns/build
    Log_LEVEL=DEBUG cmake ..
    make
  popd
}

package() {
  pushd "$srcdir"
    install -D -m755 cjdns.rc.d "$pkgdir"/etc/rc.d/cjdns
    install -D -m644 cjdns.conf.d "$pkgdir"/etc/conf.d/cjdns
    install -D -m755 cjdwebadmin.rc.d "$pkgdir"/etc/rc.d/cjdwebadmin
    install -D -m644 cjdwebadmin.conf.d "$pkgdir"/etc/conf.d/cjdwebadmin
    install -D -m755 cjdadmin "$pkgdir"/usr/bin/cjdadmin
    install -D -m755 cjdns/build/cjdroute "$pkgdir"/usr/bin/cjdroute
    install -D -m755 cjdns/build/admin/http/HttpServer "$pkgdir"/usr/bin/cjdwebadmin
    install -d "$pkgdir"/usr/share/cjdns/cjdwebadmin
    cp -R cjdns/admin/http/text "$pkgdir"/usr/share/cjdns/cjdwebadmin/
  popd
}
