# Maintainer: Jan Winkelmann <keks[at]unstable[dot]nl>
pkgname=evolution-rss-git
pkgver=20110427
pkgrel=1
pkgdesc="RSS plugin for Evolution."
arch=('i686' 'x86_64')
url="http://gnome.eu.org/evo/index.php/Evolution_RSS_Reader_Plugin"
license=('GPL')
depends=('evolution>=2.22' 'libsoup>=2.2'  'gnome-common')
makedepends=('git')
provides=('evolution-rss')

_gitroot="git://git.gnome.org/evolution-rss"
_gitname="evolution-rss"

build() {
  cd "$srcdir"
  msg "connecting to git server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "the local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "git checkout done or server timeout"
  msg "starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # build here
  #
	./autogen.sh
	./configure \
        --prefix=/usr \
        --sysconfdir=/etc \
        --localstatedir=/var \
        --disable-schemas-install
  make || return 1
  make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR=${startdir}/pkg install || return 1
  
  mkdir -p ${startdir}/pkg/usr/share/gconf/schemas
  gconf-merge-schema ${startdir}/pkg/usr/share/gconf/schemas/${pkgname}.schemas ${startdir}/pkg/etc/gconf/schemas/*.schemas
  rm -f ${startdir}/pkg/etc/gconf/schemas/*.schemas
} 
