# Maintainer: pearsw <wpearson01 at gmail dot com>

pkgname='couchpotato-v2-git'
pkgver=20120420
pkgrel=1
pkgdesc='CouchPotato V2 - automatic movie downloading via NZBs & torrents.'
arch=('any')
url='http://www.couchpota.to/'
license=('GPL')
depends=('python2')
makedepends=('git')
backup=('etc/conf.d/couchpotato-v2')
source=('couchpotato-v2.confd' 'couchpotato-v2.init' 'couchpotato-v2.sh')
md5sums=('cb2079bb2c5f794a9a053d623999bdb9'
         '65ca41fe86308c470d6c97562a0eec7d'
         'd14a439c5bc200892de2627e9acbc2a0')

_gitroot='git://github.com/RuudBurger/CouchPotatoServer.git'
_gitname='CouchPotatoServer'

build() {
  cd "$srcdir"
  msg 'Connecting to GIT server....'

  if [ -d "${_gitname}" ] ; then
    cd "${_gitname}" && git pull origin
    msg 'The local files are updated.'
  else
    git clone $_gitroot $_gitname
  fi

  msg 'GIT checkout done or server timeout'
}

package() {
  mkdir -p "${pkgdir}/usr/share/"
  cp -r "$srcdir/$_gitname" "${pkgdir}/usr/share/couchpotato-v2"

  install -D -m755 "${srcdir}/couchpotato-v2.sh" "${pkgdir}/usr/bin/couchpotato-v2"
  install -D -m755 "${srcdir}/couchpotato-v2.init" "${pkgdir}/etc/rc.d/couchpotato-v2"
  install -D -m644 "${srcdir}/couchpotato-v2.confd" "${pkgdir}/etc/conf.d/couchpotato-v2"
}
