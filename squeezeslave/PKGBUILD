# Mantainer: Mika Fischer <mika.fischer@zoopnet.de>

pkgname=squeezeslave
pkgver=1.1
pkgrel=1
pkgdesc="Light weight streaming audio player for Logitech's Squeezebox audio server"
arch=(i686 x86_64)
url="http://wiki.slimdevices.com/index.php/SqueezeSlave"
license=('GPL')
depends=('lirc-utils')
optdepends=()
makedepends=('alsa-lib' 'lirc-utils' 'ncurses' 'subversion')
provides=()
conflicts=()
source=()
md5sums=()

# Use __svn* here to prevent makepkg from overwriting ${pkgver}
__svntrunk="http://squeezeslave.googlecode.com/svn/squeezeslave/branches/squeezeslave-1.1-253"
__svnmod="squeezeslave-1.1"
__svnrev=256

build() {
    cd ${srcdir}

    if [[ -d ${__svnmod}/.svn ]]; then
        (cd ${__svnmod} && svn up -r ${__svnrev})
    else
        svn co ${__svntrunk} --config-dir ./ -r ${__svnrev} ${__svnmod}
    fi

    msg "SVN checkout done or server timeout"
    msg "Starting make..."

    rm -rf ${srcdir}/${__svnmod}-build
    cp -r ${srcdir}/${__svnmod} ${srcdir}/${__svnmod}-build
    cd ${srcdir}/${__svnmod}-build

    if [[ "${CARCH}" == "x86_64" ]]; then
        make -f makefile.linux26-i64-alsa-display || return 1
    elif [[ "${CARCH}" == "i686" ]]; then
        make -f makefile.linux26-alsa-display || return 1
    else
        echo "Unknown architecture: ${CARCH}"
        return 1
    fi

    install -D ${srcdir}/${__svnmod}-build/bin/squeezeslave ${pkgdir}/usr/bin/squeezeslave
}
