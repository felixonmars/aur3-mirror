# Maintainer: Michael Jakl <jakl.michael@gmail.com>
# With contributions from many kind people at http://aur.archlinux.org/packages.php?ID=56877

pkgname=julia-git
pkgver=20121114
pkgrel=1
pkgdesc="Julia is a high-level, high-performance, dynamic programming language."
arch=('i686' 'x86_64')
url="http://julialang.org"
license=('GPL')
depends=('llvm' 'readline' 'pcre' 'gmp' 'libunwind' 'glpk' 'fftw' 'zlib' 'arpack' 'suitesparse')
makedepends=('git' 'perl' 'gcc' 'gcc-fortran')
optdepends=('lighttpd: for the web REPL frontend'
            'nginx: alternative to lighttpd')
provides=('julia')
conflicts=('julia')

_gitroot=git://github.com/JuliaLang/julia.git
_gitname=julia

build() {
  cd "$srcdir"

  echo "Updating from upstream"
  if [[ -d $_gitname ]]; then
    cd $_gitname && git pull origin && cd ..
  else
    git clone $_gitroot
  fi

  rm -rf $_gitname-build
  git clone $_gitname $_gitname-build

  echo "Compiling"
  cd "$srcdir/$_gitname-build"
  make PREFIX=$pkgdir/usr \
    USE_SYSTEM_LLVM=1 \
    USE_SYSTEM_LIGHTTPD=1 \
    USE_SYSTEM_LIBUNWIND=1 \
    USE_SYSTEM_READLINE=1 \
    USE_SYSTEM_PCRE=1 \
    USE_SYSTEM_BLAS=1 \
    USE_SYSTEM_LAPACK=1 \
    USE_SYSTEM_FFTW=1 \
    USE_SYSTEM_GMP=1 \
    USE_SYSTEM_ARPACK=1 \
    USE_SYSTEM_SUITESPARSE=1 \
    USE_SYSTEM_GLPK=1 \
    USE_SYSTEM_NGINX=1 \
    USE_SYSTEM_ZLIB=1
}

package() {
  cd "$srcdir/$_gitname-build"
  make PREFIX=$pkgdir/usr \
    USE_SYSTEM_LLVM=1 \
    USE_SYSTEM_LIGHTTPD=1 \
    USE_SYSTEM_LIBUNWIND=1 \
    USE_SYSTEM_READLINE=1 \
    USE_SYSTEM_PCRE=1 \
    USE_SYSTEM_BLAS=1 \
    USE_SYSTEM_LAPACK=1 \
    USE_SYSTEM_FFTW=1 \
    USE_SYSTEM_GMP=1 \
    USE_SYSTEM_ARPACK=1 \
    USE_SYSTEM_SUITESPARSE=1 \
    USE_SYSTEM_GLPK=1 \
    USE_SYSTEM_NGINX=1 \
    USE_SYSTEM_ZLIB=1 \
    install
}

# vim:set ts=2 sw=2 et:
