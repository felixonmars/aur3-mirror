# Maintainer: Frozen Fox <frozenfoxz@gmail.com>
# Contributor: Aurelien Foret <orelien@chez.com>

pkgname=zsnes-netplay
pkgver=1.42n
pkgrel=1
pkgdesc="Super Nintendo emulator, patched old ver with netplay"
arch=('i686')
license=('GPL')
depends=('gcc-libs' 'glibc' 'sdl' 'libpng' 'libgl' 'ncurses' 'mesa')
makedepends=('nasm' 'gcc')
source=('http://snesemu.black-ship.net/emus/zsnes/zsnesnet.tar.bz2'
        'zsnes.desktop'
        'zsnes_icon.png')
url="http://www.zsnes.com/"
conflicts=('zsnes')
md5sums=('890fa9174edb127b1a3e7607258db32d'
         'b100b2aa342c551167d7c5dcdcde9dd4'
         'b5260c02adfc3b7ff725041214b00bfd')

build() {
  # Business as usual
  cd ${srcdir}
  sh ./autogen.sh --prefix=/usr x_libraries=/usr/lib force_arch=i686

  # Patch the makefile to use standard dirs and fix absolute paths
  sed -i 's|/usr/bin/install|/bin/install|g' ${srcdir}/Makefile
  sed -i 's|/usr/local|/usr|g' ${srcdir}/Makefile
  sed -i 's|/usr/man|/usr/share/man|g' ${srcdir}/Makefile

  # Business as usual cont'd
  make || return 1
  make DESTDIR=${startdir}/pkg install
  
  # FYI: Adding --mandir= to autoconf line fails
  # Install start menu entries and desktop icons
  install -dm755 ${pkgdir}/usr/share
  install -Dm644 ${srcdir}/zsnes.desktop ${pkgdir}/usr/share/applications/zsnes.desktop
  install -Dm644 ${srcdir}/zsnes_icon.png ${pkgdir}/usr/share/pixmaps/zsnes_icon.png
}
