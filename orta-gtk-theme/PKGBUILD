# Old Maintainer: Adria Arrufat <swiftscythe@gmail.com>
# Maintainer: twa022 <twa022 at gmail dot com>

pkgname=orta-gtk-theme
pkgver=1.4.1
pkgrel=6.1
pkgdesc="Orta GTK+, Metacity, Xfwm4 and more themes"
arch=('any')
url="http://skiesofazel.deviantart.com/art/Orta-184118297"
license=('GPL')
depends=('gtk-engines' 'python2' 'gksu')
install='orta.install'
DLAGENTS=('http::/usr/bin/wget -c -t 3 --waitretry=3 -H -U Mozilla -O %o %u')
source=(http://www.deviantart.com/download/184118297/orta_by_skiesofazel-d31mal5.zip)
noextract=(orta_by_skiesofazel-d31mal5.zip)
md5sums=('5016c78ff89c67f5461c40ba6d71cf1b')

build() {
    cd $srcdir
    unzip orta_by_skiesofazel-d31mal5.zip
    tar -xf extractme.tar.gz

    ## AWN
    mkdir -p $pkgdir/usr/share/avant-window-navigator/themes
    tar -xf Awn/OrtaAWN-0.2.0.tgz -C $pkgdir/usr/share/avant-window-navigator/themes

    ## Emerald
    mkdir -p $pkgdir/usr/share/emerald/themes
    for _file in $( find ./Emerald -name *.emerald ) ; do 
	mkdir -p $pkgdir/usr/share/emerald/themes/$( basename ${_file} | sed 's:\.emerald$::' )
	tar -xf "$_file" -C $pkgdir/usr/share/emerald/themes/$( basename ${_file} | sed 's:\.emerald$::' )
    done

    ## Manager
    sed -i 's:#!/usr/bin/python:&2:' OrtaSettingsManager.py
    install -Dm755 OrtaSettingsManager.py $pkgdir/usr/lib/orta/OrtaSettingsManager.py
    cp -r orta $pkgdir/usr/lib/orta/
    find $pkgdir/usr/lib/ -type d -exec chmod 755 '{}' \;
    find $pkgdir/usr/lib/ -type f -exec chmod 644 '{}' \;
    chmod 755 $pkgdir/usr/lib/orta/OrtaSettingsManager.py
    mkdir -p $pkgdir/usr/bin
    ln -s /usr/lib/orta/OrtaSettingsManager.py $pkgdir/usr/bin/orta-settings-manager
    
    ## Themes
    mkdir -p $pkgdir/usr/share/themes
    tar -xf Orta.tar.gz -C $pkgdir/usr/share/themes
    tar -xf Orta-Old.tar.gz -C $pkgdir/usr/share/themes
    tar -xf Orta-Old-Squared.tar.gz -C $pkgdir/usr/share/themes
    tar -xf Orta-Squared.tar.gz -C $pkgdir/usr/share/themes
    
    ## Desktop file
    mkdir -p $pkgdir/usr/share/applications/
    cat > $pkgdir/usr/share/applications/orta-settings-manager.desktop <<- __EOF__
		[Desktop Entry]
		Encoding=UTF-8
		Name=Orta Settings Manager
		Comment=Video Player
		Exec=orta-settings-manager
		Icon=gnome-settings-theme
		Terminal=false
		Type=Application
		Categories=Application;Settings;DesktopSettings;
		__EOF__
    
	## Chromium
    mkdir -p $pkgdir/usr/share/themes/orta-chromium-themes
    install -m644 Chromium/*crx $pkgdir/usr/share/themes/orta-chromium-themes
    cat > $pkgdir/usr/bin/orta-install-chrome-themes << __EOF__
#!/bin/bash

case "\$1" in 
	--remove)
		for folder in google-chrome chromium ; do 
			if [ -d "\$HOME/.config/\$folder/Default/Extensions" ]  ; then
				find "\$HOME/.config/\$folder/Default/Extensions" -name Orta*crx -exec rm '{}' \;
				echo "Removed Orta Themes from \$folder" >&2
			fi
		done
		;;
	*)
		for folder in google-chrome chromium ; do 
			if [ -d "\$HOME/.config/\$folder/Default/Extensions" ]  ; then
				find /usr/share/themes/orta-chromium-themes -name Orta*crx -exec install -m644 '{}' "\$HOME/.config/\$folder/Default/Extensions" \;
				echo "Installed Orta Themes for \$folder" >&2
			fi
		done
esac
__EOF__
    chmod +x $pkgdir/usr/bin/orta-install-chrome-themes
}
