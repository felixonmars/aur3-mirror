# contrib: kevku <kevku@gmx.com>
pkgname=cdfplayer
pkgver=8.0.4
pkgrel=1
pkgdesc="Wolfram CDF Player"
arch=('x86_64' 'i686')
url="http://www.wolfram.com/cdf-player/"
license=('custom')
depends=('unixodbc')
if [[ "$CARCH" == 'i686' ]]; then
  depends+=('alsa-lib' 'mesa' 'libxmu' 'glib2' 'libxi' 'libxrender')
else
  depends+=('lib32'-{'alsa-lib','mesa','libxmu','glib2','libxi','libxrender'})
fi
makedepends=('curl')
options=("!strip")
source=('LICENCE')
md5sums=('eb33d6bb6c6730fbe0438f25b394d328')

build() {
  cd "$srcdir/"
  msg "DL package"
curl -c cookie http://www.wolfram.com/cdf-player/ &>/dev/null
IP=$(curl -b cookie -e http://www.wolfram.com/cdf-player/request.cgi http://www.wolfram.com/cdf-player/request.cgi | grep -o '[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}')
wget $(curl -b cookie -e http://www.wolfram.com/cdf-player/request.cgi \
-d "the-platform=lnx&user-isa=&organization=&institution=&email=linux@linux.xxx&location=$IP&action=submit-verify&source_name=NoneProvided" \
http://www.wolfram.com/cdf-player/request.cgi  | sed -n '/no-start/s/^.*href="\(.*\)" target.*$/\1/p') -O CDFPlayer_"$pkgver"_LINUX.sh
  msg "DL done"
}

package() {
  cd "$srcdir/"
  sh CDFPlayer_"$pkgver"_LINUX.sh --nox11 <<- EOF
	$pkgdir/opt/Wolfram/CDFPlayer/8.0
	y
	$pkgdir/usr/bin
	y
		EOF
  ln -sf /opt/Wolfram/CDFPlayer/8.0/Executables/WolframCDFPlayer $pkgdir/usr/bin/WolframCDFPlayer
  ln -sf /opt/Wolfram/CDFPlayer/8.0/Executables/wolframcdfplayer $pkgdir/usr/bin/wolframcdfplayer
  install -Dm644 LICENCE  $pkgdir/usr/share/licenses/cdfplayer/LICENCE
  rm $pkgdir/opt/Wolfram/CDFPlayer/8.0/InstallErrors

}

# vim:set ts=2 sw=2 et:
