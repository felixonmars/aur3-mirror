# Contributor: graysky <graysky AT archlinux dot us>
# Contributor: Jordi Sanfeliu <jordi AT fibranet dot cat>

pkgname=monitorix
pkgver=2.3.0
pkgrel=3
pkgdesc='A lightweight system monitoring tool that uses rrd databases.'
arch=(any)
url="http://www.$pkgname.org"
license=(GPL)
_basedir="srv/http/monitorix"
_libdir="var/lib/$pkgname"
depends=('rrdtool' 'perl-libwww' 'perl-mime-lite' 'perl-cgi' 'perl-mailtools')
optdepends=('lm_sensors: enable support for system temp monitoring'
'smartmontools: enable support for hdd bad sector monitoring.'
'nvidia: enable support for nVidia card temp and usage monitoring.'
'hddtemp: enable support for hdd temp monitoring'
'terminus-font: if your graphs do not contain letters and numbers you may need this font package')
backup=(etc/$pkgname.conf)
source=($url/$pkgname-$pkgver.tar.gz $pkgname.rc.d)
install=$pkgname.install

package() {
 cd "$srcdir"/$pkgname-$pkgver
 install -D $pkgname "$pkgdir"/usr/bin/$pkgname
 mkdir -p "$pkgdir"/$_basedir/cgi-bin
 install -D "$pkgname".cgi "$pkgdir"/$_basedir/cgi-bin/$pkgname.cgi
 mkdir "$pkgdir"/etc

 # use Arch defaults
 sed -e '/^our $BASE_DIR/ s,\/usr\/share,\/srv\/http,' -e '/^our $BASE_CGI/ s,-cgi,\/cgi-bin,' < $pkgname.conf > "$pkgdir"/etc/$pkgname.conf

 install -dm777 "$pkgdir"/$_basedir/imgs
 mkdir -p "$pkgdir"/usr/share/doc
 install -D $pkgname.logrotate "$pkgdir"/etc/logrotate.d/$pkgname
 cp Changes COPYING $pkgname-{alert.sh,apache.conf} README README.{FreeBSD,nginx} "$pkgdir"/usr/share/doc
 cp {logo_bot,logo_top,${pkgname}ico}.png "$pkgdir"/$_basedir
 gzip -9 man/man8/$pkgname.8
 install -Dm644 man/man8/$pkgname.8.gz "$pkgdir"/usr/share/man/man8/$pkgname.8.gz
 gzip -9 man/man5/$pkgname.conf.5
 install -Dm644 man/man5/$pkgname.conf.5.gz "$pkgdir"/usr/share/man/man5/$pkgname.conf.5.gz
 mkdir -p "$pkgdir"/$_libdir
 cp -r reports "$pkgdir"/$_libdir
 install -D "$srcdir"/$pkgname.rc.d "$pkgdir"/etc/rc.d/$pkgname
}
sha256sums=('073705ef94bbd101d311efa0dc2461bd4087e8424ca71cfc401cb9380a01bd91'
            'a7b475c773c297e59a5ce4a8d1fc4e8e583902005885f440335196e83731ed84')
sha256sums=('073705ef94bbd101d311efa0dc2461bd4087e8424ca71cfc401cb9380a01bd91'
            '7b8bc443dd1461cea878404a07beaf4672e1a1c6be59f5e62e757d590cecc839')
