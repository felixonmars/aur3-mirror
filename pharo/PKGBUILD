# Contributor: Eric Forgeot < http://anamnese.online.fr >
pkgname=pharo	
pkgver=1.2.1
pkgrel=1
pkgdesc="a fork of Squeak, an implementation of the object-oriented, dynamically typed, reflective programming language Smalltalk"
arch=(i686 x86_64)
url="http://www.pharo-project.org/"
license=('MIT')
if [ "$CARCH" = "x86_64" ]; then
        depends=('lib32-alsa-lib' 'lib32-libvorbis' 'lib32-pango' 'lib32-mesa' 'nas' 'lib32-dbus-core' 'lib32-libxml2')
else
        depends=('alsa-lib' 'libvorbis' 'pango' 'mesa' 'nas' 'dbus-core' 'libxml2')
fi

source=(https://gforge.inria.fr/frs/download.php/28437/Pharo-1.2.1-OneClick.zip)
md5sums=('c988ba33e77dba33a0b413b238cc024f')


build() {
	cd $srcdir/Pharo-1.2.1-OneClick.app/
	rm -fr $srcdir/Pharo-1.2.1-OneClick.app/Contents/Windows/
	#rm $srcdir/Pharo-1.2.1-OneClick.app/Pharo.lnk
	rm -fr $srcdir/Pharo-1.2.1-OneClick.app/Contents/MacOS/
	rm -fr $srcdir/Pharo-1.2.1-OneClick.app/Contents/Resources/*.bundle
	mkdir -p $pkgdir/usr/share/pharo
	mkdir -p $pkgdir/usr/bin/
	    
	cp -fr $srcdir/Pharo-1.2.1-OneClick.app/* $pkgdir/usr/share/pharo
    echo "cd /usr/share/pharo
sh pharo.sh" > $pkgdir/usr/bin/pharo

    chmod +x $pkgdir/usr/share/pharo/pharo.sh
    chmod +x $pkgdir/usr/bin/pharo
    
    chgrp -R users $pkgdir/usr/share/pharo/
    chmod -R 775 $pkgdir/usr/share/pharo/
    
   #desktop icons
	mkdir -p $pkgdir/usr/share/pixmaps
	mkdir -p $pkgdir/usr/share/applications

	cp $srcdir/../$pkgname.png $pkgdir/usr/share/pixmaps/$pkgname.png
	
	install -D -m644 $srcdir/../$pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop

	
}


