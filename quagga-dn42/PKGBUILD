# quagga routing suite PKGBUILD
# Forked from quagga AUR by helios <helios+aur@wiresphere.de>
#
# Thanks to quagga AUR Maintainer:
# Contributor: shild <shildv@gmail.com> 
# Contributor: Georg Grabler (STiAT) <ggrabler@gmail.com>
# Contributor: Bart Kos, bro at fast-stable-secure dot net
# Contributor: HomeCreate <homecreate@list.ru>
#
# And equinox <dl@diac24.net>

pkgname=quagga-dn42
pkgver=20111028
pkgrel=1
pkgdesc="Advanced routing protocol suite. With AS4, advanced dumpfile output and IPv6 linklocal peering support"
arch=('i686' 'x86_64')
url="http://www.diac24.net/files/quagga/info-1.1.0-dn42.11.html"
license="GPL2"
makedepends=('git')
depends=('libcap' 'libnl' 'net-snmp' 'readline' 'iproute' 'cpulimit')
backup=('etc/conf.d/quagga')
install=quagga.install
provides=('quagga')
conflicts=('quagga' 'quagga-patched')
_gitroot='git://git.spaceboyz.net/equinox/quagga.git'
_gitname='quagga'

source=(zebra ripd ripngd ospfd ospf6d bgpd quagga.conf)

md5sums=('0bb8662ffb60106ca5476b559afe6fa9'
	 '892055cfd46b7bd89fd13cf4c446c07e'
	 '12075ca726cb8e401f601b17f375b88e'
	 '5069f9e6ade2e1acc9335da38b2be310'
	 'f44cdb3354e8bd70039cab07c3363cf4'
	 '83327d4d078a8d90b7e8e3c3f90b92e8'
	 '1fd63dc935eece30d871c7d007b1c432')
	 
build() {
    cd $srcdir

    if [ -e quagga ] ; then
      cd quagga
      git pull
      cd ..
    else
      git clone $_gitroot $_gitname
    fi

    cd $srcdir/quagga

    ./bootstrap.sh
    ./configure --prefix=/usr \
		--sysconfdir=/etc/quagga.d \
		--localstatedir=/var/lib/quagga \
		--enable-gcc-rdynamic \
		--enable-irdp \
		--enable-isis-topology \
		--enable-multipath=0 \
		--enable-ospf-te \
		--enable-opaque-lsa \
		--enable-snmp \
		--enable-vtysh \
		--enable-isisd \
		--enable-netlink \
		--disable-tcp-zebra \
		--enable-user=quagga \
		--enable-group=quagga
    
    make
    make DESTDIR=$pkgdir PREFIX=$pkgdir install

    for line in bgpd ospfd ospf6d zebra ripd ripngd
    do
	install -D -m 755 -o root -g root $srcdir/$line $pkgdir/etc/rc.d/$line
    done

    mkdir -p $pkgdir/etc/conf.d
    install -D -m 644 -o root -g root $srcdir/quagga.conf $pkgdir/etc/conf.d/quagga

    chmod 770 $pkgdir/etc/quagga.d
    rm $pkgdir/usr/share/info/dir

    mkdir -p $pkgdir/var/lib/quagga
}
