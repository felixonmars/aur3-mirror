# Maintainer: jsteel <mail at jsteel dot org>
# Contributor: Gadget3000 <gadget3000 at msn dot com>
# Contributor: Alessio 'mOLOk' Bolognino <themolok@gmail.com>

pkgname=gmail-notify
pkgver=1.6.1.1
pkgrel=2
pkgdesc="A Linux alternative for the notifier program released by Google"
arch=('i686' 'x86_64')
url="http://gmail-notify.sourceforge.net"
license=('GPL')
depends=('python2' 'gtk2' 'pygtk' 'libpng12')
install=gmail-notify.install
source=(http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz gmail-notify.patch
	pytrayicon.so)
md5sums=('7d62330064b3cc70c674cb721f36975a'
         '1d4d0c39af6f63febc16cac95f0f937e'
         '003fd6111aa2c4924308f79c10ae0f09')

build() {
  cd $srcdir/$pkgname

  patch < ../gmail-notify.patch

  mkdir -p $pkgdir/{etc,usr/{bin,share/gmail-notify}} 
  cp -R *  $pkgdir/usr/share/gmail-notify/

  mv $pkgdir/usr/share/gmail-notify/notifier.conf.sample \
        $pkgdir/etc/

  ln -s ../share/$pkgname/notifier.py $pkgdir/usr/bin/gmail-notify

  for i in $(find $pkgdir | grep "\.py"); do
		sed "s/\#\!\/usr\/bin\/python/\#\!\/usr\/bin\/python2/" -i $i
		sed "s/\#\!\/usr\/bin\/env python/\#\!\/usr\/bin\/env python2/g" -i $i
  done

  if [ "$CARCH" = "x86_64" ]; then
	cp -f $srcdir/pytrayicon.so $pkgdir/usr/share/gmail-notify/
  fi

  mv $pkgdir/etc/notifier.conf.sample $pkgdir/usr/share/gmail-notify/
  rm -r $pkgdir/etc
}
