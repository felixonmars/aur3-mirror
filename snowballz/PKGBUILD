# Contributor: Paolo Giangrandi <peoro.noob@gmail.com>
# Contributor: Marc poiroud <marciun@free.fr>

pkgname=snowballz
pkgver=0.9.5.1
pkgrel=3
pkgdesc="A fun RTS game featuring snowball fights with penguins."
license="GPL"
depends=('python' 'python-pygame' 'python-opengl' 'python-rabbyt')
install=snowballz.install
source=(http://joey101.net/snowballz/files/$pkgname-$pkgver.tar.gz snowballz.desktop snowballz.png \
        snowballz snowballz.install)
md5sums=('197e3281cc85f9fe89a45c622e08ba0d' 'abe4faa6864022e3274955039792e1c7' \
         '1eb0c353d99dc54d02c340fc057d28d2' '7fdfd218e42f763d37312cc1181378b6' \
         '291effd03d9a528519ba1bacfdf976d7')
arch=('i686' 'x86_64')
url="http://joey101.net/snowballz/"

build() {
	cd $startdir/src/$pkgname-$pkgver
	install -d -m755 $startdir/pkg/usr/share/{$pkgname,pixmaps,applications}
	
	# removing pygame.mixer calls, since it doesn't support MP3s and that crashes the game
	for i in *.py; do cat $i | sed -r "s/^([ \t]*)(pygame\.mixer.*)$/\1pass/" > _tmp_$i_; rm -f $i; mv _tmp_$i_ $i; done

	# copy to final directory
	cp -r *.py buildings data maps plugins cellulose gooeypy $startdir/pkg/usr/share/$pkgname/

	# create false exe in /usr/bin
	install -D -m755 $startdir/src/snowballz $startdir/pkg/usr/bin/snowballz

	# create menu integration with desktop file and PNG
	install -m644 $startdir/src/snowballz.png $startdir/pkg/usr/share/pixmaps/snowballz.png
	install -m644 $startdir/src/snowballz.desktop $startdir/pkg/usr/share/applications/snowballz.desktop
}
